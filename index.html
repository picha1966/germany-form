<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Document Form</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #1a1a1a);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --link-color: var(--tg-theme-link-color, #3390ec);
            --button-color: var(--tg-theme-button-color, #4caf50);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f5f5f5);
            --border-color: #e0e0e0;
            --border-focus: var(--link-color);
            --error-color: #e53935;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --button-disabled: #cccccc;
            --input-bg: var(--secondary-bg);
        }
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px 16px 140px;
        }
        .header {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .header p {
            font-size: 14px;
            color: var(--hint-color);
        }
        .draft-banner {
            background-color: #fff3e0;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: space-between;
            border-left: 3px solid var(--warning-color);
        }
        .draft-banner.visible {
            display: flex;
        }
        .draft-banner-text {
            display: flex;
            align-items: center;
        }
        .draft-banner-text .icon {
            margin-right: 8px;
            font-size: 16px;
        }
        .draft-banner .clear-draft-btn {
            background: none;
            border: none;
            color: var(--error-color);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .draft-banner .clear-draft-btn:active {
            background-color: rgba(229, 57, 53, 0.1);
        }
        @media (prefers-color-scheme: dark) {
            .draft-banner {
                background-color: #3d2e1a;
            }
        }
        .section-header {
            font-size: 13px;
            font-weight: 600;
            color: var(--hint-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            margin-top: 24px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .section-header:first-of-type {
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-color);
        }
        .form-group label .required {
            color: var(--error-color);
            margin-left: 2px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--input-bg);
            color: var(--text-color);
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            -webkit-user-select: text !important;
            user-select: text !important;
            -webkit-touch-callout: default !important;
            touch-action: manipulation;
            -webkit-appearance: none;
            appearance: none;
        }
        .form-group textarea {
            min-height: 90px;
            resize: vertical;
        }
        .form-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
            cursor: pointer;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(51, 144, 236, 0.15);
        }
        .form-group input.valid,
        .form-group select.valid,
        .form-group textarea.valid {
            border-color: var(--success-color);
        }
        .form-group input.invalid,
        .form-group select.invalid,
        .form-group textarea.invalid {
            border-color: var(--error-color);
        }
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--hint-color);
            opacity: 0.8;
        }
        .error-hint {
            font-size: 12px;
            color: var(--error-color);
            margin-top: 4px;
            min-height: 16px;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .error-hint.visible {
            visibility: visible;
            opacity: 1;
        }
        .validation-status {
            background-color: var(--input-bg);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        .validation-status.incomplete {
            border-left: 3px solid var(--error-color);
        }
        .validation-status.complete {
            border-left: 3px solid var(--success-color);
        }
        .validation-status .icon {
            margin-right: 8px;
            font-size: 16px;
        }
        .form-section {
            display: none;
        }
        .form-section.visible {
            display: block;
        }
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: linear-gradient(transparent, var(--bg-color) 30%);
            z-index: 100;
        }
        .submit-btn {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            display: block;
            padding: 16px 24px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        .submit-btn:disabled {
            background-color: var(--button-disabled);
            color: #888888;
            cursor: not-allowed;
        }
        .submit-btn:not(:disabled) {
            background-color: var(--button-color);
            color: var(--button-text-color);
        }
        .submit-btn:not(:disabled):active {
            transform: scale(0.98);
        }
        .submit-btn.loading {
            background-color: var(--hint-color);
            pointer-events: none;
        }
        .form-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            font-size: 13px;
            color: var(--hint-color);
        }
        .draft-status {
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .draft-status.visible {
            opacity: 1;
        }
        .draft-status .icon {
            margin-right: 4px;
            font-size: 12px;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.4s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        @media (max-width: 360px) {
            .container {
                padding: 16px 12px 140px;
            }
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 12px 14px;
                font-size: 15px;
            }
            .header h1 {
                font-size: 20px;
            }
            .draft-banner {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="formTitle">Document Form</h1>
            <p id="formDescription">Fill in the required information</p>
        </div>

        <div class="draft-banner" id="draftBanner">
            <div class="draft-banner-text">
                <span class="icon">ğŸ“</span>
                <span id="draftBannerText">Draft restored</span>
            </div>
            <button type="button" class="clear-draft-btn" id="clearDraftBtn">Clear</button>
        </div>

        <div class="validation-status incomplete" id="validationStatus">
            <span class="icon" id="statusIcon">âš ï¸</span>
            <span id="statusText">Fill required fields</span>
        </div>

        <form id="masterForm" autocomplete="off" novalidate>

            <!-- PERSONAL SECTION -->
            <div class="form-section visible" id="section_personal">
                <div class="section-header" id="hdr_personal">Personal Data</div>

                <div class="form-group">
                    <label for="first_name" id="lbl_first_name">First Name <span class="required">*</span></label>
                    <input type="text" id="first_name" name="first_name" placeholder="" autocomplete="given-name" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_first_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="last_name" id="lbl_last_name">Last Name <span class="required">*</span></label>
                    <input type="text" id="last_name" name="last_name" placeholder="" autocomplete="family-name" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_last_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="birth_date" id="lbl_birth_date">Birth Date <span class="required">*</span></label>
                    <input type="text" id="birth_date" name="birth_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="personal" data-required="true" data-format="date">
                    <div class="error-hint" id="err_birth_date">Format: DD.MM.YYYY</div>
                </div>

                <div class="form-group">
                    <label for="birth_place" id="lbl_birth_place">Birth Place <span class="required">*</span></label>
                    <input type="text" id="birth_place" name="birth_place" placeholder="" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_birth_place">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="nationality" id="lbl_nationality">Nationality <span class="required">*</span></label>
                    <input type="text" id="nationality" name="nationality" placeholder="" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_nationality">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="marital_status" id="lbl_marital_status">Marital Status <span class="required">*</span></label>
                    <select id="marital_status" name="marital_status" data-section="personal" data-required="true">
                        <option value="" id="opt_ms_empty">-- Select --</option>
                        <option value="single" id="opt_ms_single">Single</option>
                        <option value="married" id="opt_ms_married">Married</option>
                        <option value="divorced" id="opt_ms_divorced">Divorced</option>
                        <option value="widowed" id="opt_ms_widowed">Widowed</option>
                        <option value="separated" id="opt_ms_separated">Separated</option>
                        <option value="civil_union" id="opt_ms_civil_union">Civil Union</option>
                    </select>
                    <div class="error-hint" id="err_marital_status">Please select</div>
                </div>

                <div class="form-group">
                    <label for="religion" id="lbl_religion">Religion <span class="required">*</span></label>
                    <select id="religion" name="religion" data-section="personal" data-required="true">
                        <option value="" id="opt_rel_empty">-- Select --</option>
                        <option value="none" id="opt_rel_none">None</option>
                        <option value="protestant" id="opt_rel_protestant">Protestant</option>
                        <option value="catholic" id="opt_rel_catholic">Catholic</option>
                        <option value="orthodox" id="opt_rel_orthodox">Orthodox</option>
                        <option value="muslim" id="opt_rel_muslim">Muslim</option>
                        <option value="jewish" id="opt_rel_jewish">Jewish</option>
                        <option value="other" id="opt_rel_other">Other</option>
                    </select>
                    <div class="error-hint" id="err_religion">Please select</div>
                </div>
            </div>

            <!-- ADDRESS SECTION -->
            <div class="form-section" id="section_address">
                <div class="section-header" id="hdr_address">Address</div>

                <div class="form-group">
                    <label for="street" id="lbl_street">Street <span class="required">*</span></label>
                    <input type="text" id="street" name="street" placeholder="" autocomplete="street-address" data-section="address" data-required="true" data-min="2">
                    <div class="error-hint" id="err_street">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="house_number" id="lbl_house_number">House Number <span class="required">*</span></label>
                    <input type="text" id="house_number" name="house_number" placeholder="" data-section="address" data-required="true" data-min="1">
                    <div class="error-hint" id="err_house_number">Required</div>
                </div>

                <div class="form-group">
                    <label for="postal_code" id="lbl_postal_code">Postal Code <span class="required">*</span></label>
                    <input type="text" id="postal_code" name="postal_code" placeholder="12345" inputmode="numeric" maxlength="5" data-section="address" data-required="true" data-format="plz">
                    <div class="error-hint" id="err_postal_code">Exactly 5 digits</div>
                </div>

                <div class="form-group">
                    <label for="city" id="lbl_city">City <span class="required">*</span></label>
                    <input type="text" id="city" name="city" placeholder="" autocomplete="address-level2" data-section="address" data-required="true" data-min="2">
                    <div class="error-hint" id="err_city">Minimum 2 characters</div>
                </div>

                <div class="form-group" id="group_previous_address">
                    <label for="previous_address" id="lbl_previous_address">Previous Address</label>
                    <input type="text" id="previous_address" name="previous_address" placeholder="" data-section="address" data-required="false" data-min="0">
                    <div class="error-hint" id="err_previous_address"></div>
                </div>

                <div class="form-group" id="group_move_in_date">
                    <label for="move_in_date" id="lbl_move_in_date">Move-in Date <span class="required">*</span></label>
                    <input type="text" id="move_in_date" name="move_in_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="address" data-required="true" data-format="date">
                    <div class="error-hint" id="err_move_in_date">Format: DD.MM.YYYY</div>
                </div>
            </div>

            <!-- HOUSING SECTION -->
            <div class="form-section" id="section_housing">
                <div class="section-header" id="hdr_housing">Housing</div>

                <div class="form-group">
                    <label for="landlord_name" id="lbl_landlord_name">Landlord Name <span class="required">*</span></label>
                    <input type="text" id="landlord_name" name="landlord_name" placeholder="" data-section="housing" data-required="true" data-min="2">
                    <div class="error-hint" id="err_landlord_name">Minimum 2 characters</div>
                </div>
            </div>

            <!-- BANK SECTION -->
            <div class="form-section" id="section_bank">
                <div class="section-header" id="hdr_bank">Bank Details</div>

                <div class="form-group">
                    <label for="iban" id="lbl_iban">IBAN <span class="required">*</span></label>
                    <input type="text" id="iban" name="iban" placeholder="DE00 0000 0000 0000 0000 00" inputmode="text" maxlength="42" data-section="bank" data-required="true" data-format="iban">
                    <div class="error-hint" id="err_iban">Enter valid IBAN</div>
                </div>

                <div class="form-group">
                    <label for="bic" id="lbl_bic">BIC <span class="required">*</span></label>
                    <input type="text" id="bic" name="bic" placeholder="COBADEFFXXX" inputmode="text" maxlength="11" data-section="bank" data-required="true" data-format="bic">
                    <div class="error-hint" id="err_bic">8-11 characters</div>
                </div>

                <div class="form-group">
                    <label for="account_holder" id="lbl_account_holder">Account Holder <span class="required">*</span></label>
                    <input type="text" id="account_holder" name="account_holder" placeholder="" data-section="bank" data-required="true" data-min="2">
                    <div class="error-hint" id="err_account_holder">Minimum 2 characters</div>
                </div>
            </div>

            <!-- CHILD SECTION -->
            <div class="form-section" id="section_child">
                <div class="section-header" id="hdr_child">Child Information</div>

                <div class="form-group">
                    <label for="child_first_name" id="lbl_child_first_name">Child First Name <span class="required">*</span></label>
                    <input type="text" id="child_first_name" name="child_first_name" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_first_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="child_last_name" id="lbl_child_last_name">Child Last Name <span class="required">*</span></label>
                    <input type="text" id="child_last_name" name="child_last_name" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_last_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="child_birth_date" id="lbl_child_birth_date">Child Birth Date <span class="required">*</span></label>
                    <input type="text" id="child_birth_date" name="child_birth_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="child" data-required="true" data-format="date">
                    <div class="error-hint" id="err_child_birth_date">Format: DD.MM.YYYY</div>
                </div>

                <div class="form-group">
                    <label for="child_birth_place" id="lbl_child_birth_place">Child Birth Place <span class="required">*</span></label>
                    <input type="text" id="child_birth_place" name="child_birth_place" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_birth_place">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="child_nationality" id="lbl_child_nationality">Child Nationality <span class="required">*</span></label>
                    <input type="text" id="child_nationality" name="child_nationality" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_nationality">Minimum 2 characters</div>
                </div>
            </div>

            <!-- SIGNATURE SECTION -->
            <div class="form-section" id="section_signature">
                <div class="section-header" id="hdr_signature">Signature</div>

                <div class="form-group">
                    <label for="signature_place" id="lbl_signature_place">Signature Place <span class="required">*</span></label>
                    <input type="text" id="signature_place" name="signature_place" placeholder="" data-section="signature" data-required="true" data-min="2">
                    <div class="error-hint" id="err_signature_place">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="signature_date" id="lbl_signature_date">Signature Date <span class="required">*</span></label>
                    <input type="text" id="signature_date" name="signature_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="signature" data-required="true" data-format="date">
                    <div class="error-hint" id="err_signature_date">Format: DD.MM.YYYY</div>
                </div>
            </div>

        </form>

        <div class="form-footer">
            <div class="field-counter">
                <span id="filledText">Filled:</span>
                <span id="filledCount">0</span> /
                <span id="totalCount">0</span>
                <span id="fieldsText">fields</span>
            </div>
            <div class="draft-status" id="draftStatus">
                <span class="icon">ğŸ’¾</span>
                <span id="draftSavedText">Draft saved</span>
            </div>
        </div>
    </div>

    <div class="submit-container">
        <button type="button" class="submit-btn" id="submitBtn" disabled>Submit</button>
    </div>

    <script>
    (function() {
        'use strict';

        // ========================================
        // URL PARAMS - LANGUAGE ONLY FROM URL
        // ========================================
        function getUrlParams() {
            var params = new URLSearchParams(window.location.search);
            var docType = (params.get('doc_type') || 'anmeldung').toLowerCase();
            var lang = (params.get('lang') || 'ua').toLowerCase();
            
            // Normalize uk -> ua
            if (lang === 'uk') lang = 'ua';
            
            // Supported languages
            var supported = ['ua', 'de', 'en', 'tr', 'ar', 'pl'];
            if (supported.indexOf(lang) === -1) lang = 'ua';
            
            return { docType: docType, lang: lang };
        }

        var PARAMS = getUrlParams();
        var currentDocType = PARAMS.docType;
        var currentLang = PARAMS.lang;

        console.log('[WebApp] doc_type=' + currentDocType + ', lang=' + currentLang);

        // ========================================
        // TELEGRAM WEBAPP
        // ========================================
        var tg = window.Telegram && window.Telegram.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // ========================================
        // I18N TRANSLATIONS
        // ========================================
        var I18N = {
            ua: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Ğ ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ·Ğ° Ğ¼Ñ–ÑÑ†ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ½Ñ', kindergeld: 'Ğ—Ğ°ÑĞ²Ğ° Ğ½Ğ° Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñƒ Ğ½Ğ° Ğ´Ñ–Ñ‚ĞµĞ¹' },
                ui: {
                    restored: 'Ğ’Ñ–Ğ´Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ Ğ½ĞµĞ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ñƒ Ğ°Ğ½ĞºĞµÑ‚Ñƒ',
                    clear: 'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸',
                    incomplete: "Ğ—Ğ°Ğ¿Ğ¾Ğ²Ğ½Ñ–Ñ‚ÑŒ Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ñ– Ğ¿Ğ¾Ğ»Ñ",
                    ready: 'Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğ´Ğ¾ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸',
                    filled: 'Ğ—Ğ°Ğ¿Ğ¾Ğ²Ğ½ĞµĞ½Ğ¾:',
                    fields: 'Ğ¿Ğ¾Ğ»Ñ–Ğ²',
                    draft_saved: 'Ğ§ĞµÑ€Ğ½ĞµÑ‚ĞºĞ° Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ°',
                    generating: 'Ğ“ĞµĞ½ĞµÑ€ÑƒÑ”Ğ¼Ğ¾...',
                    submit: 'Ğ—Ğ³ĞµĞ½ĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚'
                },
                headers: {
                    personal: 'ĞÑĞ¾Ğ±Ğ¸ÑÑ‚Ñ– Ğ´Ğ°Ğ½Ñ–',
                    address: 'ĞĞ´Ñ€ĞµÑĞ°',
                    housing: 'Ğ–Ğ¸Ñ‚Ğ»Ğ¾',
                    bank: 'Ğ‘Ğ°Ğ½ĞºÑ–Ğ²ÑÑŒĞºÑ– Ñ€ĞµĞºĞ²Ñ–Ğ·Ğ¸Ñ‚Ğ¸',
                    child: 'Ğ”Ğ°Ğ½Ñ– Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸',
                    signature: 'ĞŸÑ–Ğ´Ğ¿Ğ¸Ñ'
                },
                labels: {
                    first_name: "Ğ†Ğ¼'Ñ",
                    last_name: 'ĞŸÑ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ',
                    birth_date: 'Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ',
                    birth_place: 'ĞœÑ–ÑÑ†Ğµ Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ',
                    nationality: 'Ğ“Ñ€Ğ¾Ğ¼Ğ°Ğ´ÑĞ½ÑÑ‚Ğ²Ğ¾',
                    marital_status: 'Ğ¡Ñ–Ğ¼ĞµĞ¹Ğ½Ğ¸Ğ¹ ÑÑ‚Ğ°Ğ½',
                    religion: 'Ğ’Ñ–Ñ€Ğ¾ÑĞ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ğ½Ğ½Ñ',
                    street: 'Ğ’ÑƒĞ»Ğ¸Ñ†Ñ',
                    house_number: 'ĞĞ¾Ğ¼ĞµÑ€ Ğ±ÑƒĞ´Ğ¸Ğ½ĞºÑƒ',
                    postal_code: 'ĞŸĞ¾ÑˆÑ‚Ğ¾Ğ²Ğ¸Ğ¹ Ñ–Ğ½Ğ´ĞµĞºÑ',
                    city: 'ĞœÑ–ÑÑ‚Ğ¾',
                    previous_address: 'ĞŸĞ¾Ğ¿ĞµÑ€ĞµĞ´Ğ½Ñ Ğ°Ğ´Ñ€ĞµÑĞ°',
                    move_in_date: 'Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°Ñ—Ğ·Ğ´Ñƒ',
                    landlord_name: 'ĞÑ€ĞµĞ½Ğ´Ğ¾Ğ´Ğ°Ğ²ĞµÑ†ÑŒ (ĞŸĞ†Ğ‘)',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Ğ’Ğ»Ğ°ÑĞ½Ğ¸Ğº Ñ€Ğ°Ñ…ÑƒĞ½ĞºÑƒ',
                    child_first_name: "Ğ†Ğ¼'Ñ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸",
                    child_last_name: 'ĞŸÑ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸',
                    child_birth_date: 'Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸',
                    child_birth_place: 'ĞœÑ–ÑÑ†Ğµ Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸',
                    child_nationality: 'Ğ“Ñ€Ğ¾Ğ¼Ğ°Ğ´ÑĞ½ÑÑ‚Ğ²Ğ¾ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸',
                    signature_place: 'ĞœÑ–ÑÑ‚Ğ¾ Ğ¿Ñ–Ğ´Ğ¿Ğ¸ÑÑƒ',
                    signature_date: 'Ğ”Ğ°Ñ‚Ğ° Ğ¿Ñ–Ğ´Ğ¿Ğ¸ÑÑƒ'
                },
                placeholders: {
                    first_name: "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ñ–Ğ¼'Ñ",
                    last_name: 'Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ğ¿Ñ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ',
                    birth_date: 'DD.MM.YYYY',
                    birth_place: 'Ğ½Ğ°Ğ¿Ñ€., ĞšĞ¸Ñ—Ğ²',
                    nationality: 'Ğ½Ğ°Ğ¿Ñ€., ukrainisch',
                    street: 'Ğ½Ğ°Ğ¿Ñ€., HauptstraÃŸe',
                    house_number: 'Ğ½Ğ°Ğ¿Ñ€., 15a',
                    postal_code: '12345',
                    city: 'Ğ½Ğ°Ğ¿Ñ€., Berlin',
                    previous_address: 'Ğ½Ğ°Ğ¿Ñ€., Alte StraÃŸe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.YYYY',
                    landlord_name: "Ğ†Ğ¼'Ñ Ğ¾Ñ€ĞµĞ½Ğ´Ğ¾Ğ´Ğ°Ğ²Ñ†Ñ",
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'Ğ½Ğ°Ğ¿Ñ€., Max Mustermann',
                    child_first_name: "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ñ–Ğ¼'Ñ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸",
                    child_last_name: 'Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ¿Ñ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ¸',
                    child_birth_date: 'DD.MM.YYYY',
                    child_birth_place: 'Ğ½Ğ°Ğ¿Ñ€., Berlin',
                    child_nationality: 'Ğ½Ğ°Ğ¿Ñ€., deutsch',
                    signature_place: 'Ğ½Ğ°Ğ¿Ñ€., Berlin',
                    signature_date: 'DD.MM.YYYY'
                },
                errors: {
                    min2: 'ĞœÑ–Ğ½Ñ–Ğ¼ÑƒĞ¼ 2 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¸',
                    required: "ĞĞ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğµ Ğ¿Ğ¾Ğ»Ğµ",
                    date: 'Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: DD.MM.YYYY',
                    plz: 'Ğ Ñ–Ğ²Ğ½Ğ¾ 5 Ñ†Ğ¸Ñ„Ñ€',
                    iban: 'Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ ĞºĞ¾Ñ€ĞµĞºÑ‚Ğ½Ğ¸Ğ¹ IBAN',
                    bic: '8-11 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ–Ğ²',
                    select: 'ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ'
                },
                select: {
                    empty: '-- ĞĞ±Ñ€Ğ°Ñ‚Ğ¸ --',
                    ms: { single: 'ĞĞµĞ¾Ğ´Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¹/Ğ½ĞµĞ¾Ğ´Ñ€ÑƒĞ¶ĞµĞ½Ğ°', married: 'ĞĞ´Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¹/Ğ·Ğ°Ğ¼Ñ–Ğ¶Ğ½Ñ', divorced: 'Ğ Ğ¾Ğ·Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¹/Ñ€Ğ¾Ğ·Ğ»ÑƒÑ‡ĞµĞ½Ğ°', widowed: 'Ğ’Ğ´Ñ–Ğ²ĞµÑ†ÑŒ/Ğ²Ğ´Ğ¾Ğ²Ğ°', separated: 'ĞĞºÑ€ĞµĞ¼Ğ¾ Ğ¿Ñ€Ğ¾Ğ¶Ğ¸Ğ²Ğ°Ñ”', civil_union: 'ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€ÑÑ‚Ğ²Ğ¾' },
                    rel: { none: 'ĞĞµĞ¼Ğ°Ñ”', protestant: 'ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ°Ğ½Ñ‚', catholic: 'ĞšĞ°Ñ‚Ğ¾Ğ»Ğ¸Ğº', orthodox: 'ĞŸÑ€Ğ°Ğ²Ğ¾ÑĞ»Ğ°Ğ²Ğ½Ğ¸Ğ¹', muslim: 'ĞœÑƒÑÑƒĞ»ÑŒĞ¼Ğ°Ğ½Ğ¸Ğ½', jewish: 'Ğ®Ğ´ĞµĞ¹', other: 'Ğ†Ğ½ÑˆĞµ' }
                }
            },
            de: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Wohnsitz registrieren', kindergeld: 'Antrag auf Kindergeld' },
                ui: {
                    restored: 'Entwurf wiederhergestellt',
                    clear: 'LÃ¶schen',
                    incomplete: 'Bitte Pflichtfelder ausfÃ¼llen',
                    ready: 'Bereit zum Senden',
                    filled: 'AusgefÃ¼llt:',
                    fields: 'Felder',
                    draft_saved: 'Entwurf gespeichert',
                    generating: 'Erstelle...',
                    submit: 'Dokument erstellen'
                },
                headers: {
                    personal: 'PersÃ¶nliche Daten',
                    address: 'Adresse',
                    housing: 'Wohnung',
                    bank: 'Bankdaten',
                    child: 'Kind',
                    signature: 'Unterschrift'
                },
                labels: {
                    first_name: 'Vorname',
                    last_name: 'Nachname',
                    birth_date: 'Geburtsdatum',
                    birth_place: 'Geburtsort',
                    nationality: 'StaatsangehÃ¶rigkeit',
                    marital_status: 'Familienstand',
                    religion: 'Religion',
                    street: 'StraÃŸe',
                    house_number: 'Hausnummer',
                    postal_code: 'PLZ',
                    city: 'Ort',
                    previous_address: 'Bisherige Anschrift',
                    move_in_date: 'Einzugsdatum',
                    landlord_name: 'Wohnungsgeber (Name)',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Kontoinhaber',
                    child_first_name: 'Vorname des Kindes',
                    child_last_name: 'Nachname des Kindes',
                    child_birth_date: 'Geburtsdatum des Kindes',
                    child_birth_place: 'Geburtsort des Kindes',
                    child_nationality: 'StaatsangehÃ¶rigkeit des Kindes',
                    signature_place: 'Ort (Unterschrift)',
                    signature_date: 'Datum (Unterschrift)'
                },
                placeholders: {
                    first_name: 'Geben Sie Ihren Vornamen ein',
                    last_name: 'Geben Sie Ihren Nachnamen ein',
                    birth_date: 'TT.MM.JJJJ',
                    birth_place: 'z.B., Berlin',
                    nationality: 'z.B., deutsch',
                    street: 'z.B., HauptstraÃŸe',
                    house_number: 'z.B., 15a',
                    postal_code: '12345',
                    city: 'z.B., Berlin',
                    previous_address: 'z.B., Alte StraÃŸe 15, 10117 Berlin',
                    move_in_date: 'TT.MM.JJJJ',
                    landlord_name: 'Name des Wohnungsgebers',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'z.B., Max Mustermann',
                    child_first_name: 'Vorname des Kindes eingeben',
                    child_last_name: 'Nachname des Kindes eingeben',
                    child_birth_date: 'TT.MM.JJJJ',
                    child_birth_place: 'z.B., Berlin',
                    child_nationality: 'z.B., deutsch',
                    signature_place: 'z.B., Berlin',
                    signature_date: 'TT.MM.JJJJ'
                },
                errors: {
                    min2: 'Mindestens 2 Zeichen',
                    required: 'Pflichtfeld',
                    date: 'Format: TT.MM.JJJJ',
                    plz: 'Genau 5 Ziffern',
                    iban: 'Geben Sie eine gÃ¼ltige IBAN ein',
                    bic: '8-11 Zeichen',
                    select: 'Bitte auswÃ¤hlen'
                },
                select: {
                    empty: '-- AuswÃ¤hlen --',
                    ms: { single: 'Ledig', married: 'Verheiratet', divorced: 'Geschieden', widowed: 'Verwitwet', separated: 'Getrennt lebend', civil_union: 'Eingetragene Partnerschaft' },
                    rel: { none: 'Keine', protestant: 'Evangelisch', catholic: 'Katholisch', orthodox: 'Orthodox', muslim: 'Muslimisch', jewish: 'JÃ¼disch', other: 'Andere' }
                }
            },
            en: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Residence registration', kindergeld: 'Child benefit application' },
                ui: {
                    restored: 'Draft restored',
                    clear: 'Clear',
                    incomplete: 'Please fill required fields',
                    ready: 'Form ready to submit',
                    filled: 'Filled:',
                    fields: 'fields',
                    draft_saved: 'Draft saved',
                    generating: 'Generating...',
                    submit: 'Generate document'
                },
                headers: {
                    personal: 'Personal Data',
                    address: 'Address',
                    housing: 'Housing',
                    bank: 'Bank Details',
                    child: 'Child Information',
                    signature: 'Signature'
                },
                labels: {
                    first_name: 'First Name',
                    last_name: 'Last Name',
                    birth_date: 'Birth Date',
                    birth_place: 'Birth Place',
                    nationality: 'Nationality',
                    marital_status: 'Marital Status',
                    religion: 'Religion',
                    street: 'Street',
                    house_number: 'House Number',
                    postal_code: 'Postal Code',
                    city: 'City',
                    previous_address: 'Previous Address',
                    move_in_date: 'Move-in Date',
                    landlord_name: 'Landlord Name',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Account Holder',
                    child_first_name: 'Child First Name',
                    child_last_name: 'Child Last Name',
                    child_birth_date: 'Child Birth Date',
                    child_birth_place: 'Child Birth Place',
                    child_nationality: 'Child Nationality',
                    signature_place: 'Signature Place',
                    signature_date: 'Signature Date'
                },
                placeholders: {
                    first_name: 'Enter your first name',
                    last_name: 'Enter your last name',
                    birth_date: 'DD.MM.YYYY',
                    birth_place: 'e.g., Kyiv',
                    nationality: 'e.g., Ukrainian',
                    street: 'e.g., HauptstraÃŸe',
                    house_number: 'e.g., 15a',
                    postal_code: '12345',
                    city: 'e.g., Berlin',
                    previous_address: 'e.g., Alte StraÃŸe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.YYYY',
                    landlord_name: 'Name of landlord',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'e.g., Max Mustermann',
                    child_first_name: 'Enter child first name',
                    child_last_name: 'Enter child last name',
                    child_birth_date: 'DD.MM.YYYY',
                    child_birth_place: 'e.g., Berlin',
                    child_nationality: 'e.g., German',
                    signature_place: 'e.g., Berlin',
                    signature_date: 'DD.MM.YYYY'
                },
                errors: {
                    min2: 'Minimum 2 characters',
                    required: 'Required',
                    date: 'Format: DD.MM.YYYY',
                    plz: 'Exactly 5 digits',
                    iban: 'Enter valid IBAN',
                    bic: '8-11 characters',
                    select: 'Please select'
                },
                select: {
                    empty: '-- Select --',
                    ms: { single: 'Single', married: 'Married', divorced: 'Divorced', widowed: 'Widowed', separated: 'Separated', civil_union: 'Civil Union' },
                    rel: { none: 'None', protestant: 'Protestant', catholic: 'Catholic', orthodox: 'Orthodox', muslim: 'Muslim', jewish: 'Jewish', other: 'Other' }
                }
            },
            tr: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Ä°kamet kaydÄ±', kindergeld: 'Ã‡ocuk parasÄ± baÅŸvurusu' },
                ui: {
                    restored: 'Taslak geri yÃ¼klendi',
                    clear: 'Temizle',
                    incomplete: 'LÃ¼tfen zorunlu alanlarÄ± doldurun',
                    ready: 'Form gÃ¶nderilmeye hazÄ±r',
                    filled: 'Dolduruldu:',
                    fields: 'alan',
                    draft_saved: 'Taslak kaydedildi',
                    generating: 'OluÅŸturuluyor...',
                    submit: 'Belge oluÅŸtur'
                },
                headers: {
                    personal: 'KiÅŸisel Bilgiler',
                    address: 'Adres',
                    housing: 'Konut',
                    bank: 'Banka Bilgileri',
                    child: 'Ã‡ocuk Bilgileri',
                    signature: 'Ä°mza'
                },
                labels: {
                    first_name: 'Ad',
                    last_name: 'Soyad',
                    birth_date: 'DoÄŸum Tarihi',
                    birth_place: 'DoÄŸum Yeri',
                    nationality: 'Uyruk',
                    marital_status: 'Medeni Durum',
                    religion: 'Din',
                    street: 'Sokak',
                    house_number: 'Ev NumarasÄ±',
                    postal_code: 'Posta Kodu',
                    city: 'Åehir',
                    previous_address: 'Ã–nceki Adres',
                    move_in_date: 'TaÅŸÄ±nma Tarihi',
                    landlord_name: 'Ev Sahibi AdÄ±',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Hesap Sahibi',
                    child_first_name: 'Ã‡ocuÄŸun AdÄ±',
                    child_last_name: 'Ã‡ocuÄŸun SoyadÄ±',
                    child_birth_date: 'Ã‡ocuÄŸun DoÄŸum Tarihi',
                    child_birth_place: 'Ã‡ocuÄŸun DoÄŸum Yeri',
                    child_nationality: 'Ã‡ocuÄŸun UyruÄŸu',
                    signature_place: 'Ä°mza Yeri',
                    signature_date: 'Ä°mza Tarihi'
                },
                placeholders: {
                    first_name: 'AdÄ±nÄ±zÄ± girin',
                    last_name: 'SoyadÄ±nÄ±zÄ± girin',
                    birth_date: 'GG.AA.YYYY',
                    birth_place: 'Ã¶rn., Ä°stanbul',
                    nationality: 'Ã¶rn., TÃ¼rk',
                    street: 'Ã¶rn., HauptstraÃŸe',
                    house_number: 'Ã¶rn., 15a',
                    postal_code: '12345',
                    city: 'Ã¶rn., Berlin',
                    previous_address: 'Ã¶rn., Alte StraÃŸe 15, 10117 Berlin',
                    move_in_date: 'GG.AA.YYYY',
                    landlord_name: 'Ev sahibinin adÄ±',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'Ã¶rn., Max Mustermann',
                    child_first_name: 'Ã‡ocuÄŸun adÄ±nÄ± girin',
                    child_last_name: 'Ã‡ocuÄŸun soyadÄ±nÄ± girin',
                    child_birth_date: 'GG.AA.YYYY',
                    child_birth_place: 'Ã¶rn., Berlin',
                    child_nationality: 'Ã¶rn., Alman',
                    signature_place: 'Ã¶rn., Berlin',
                    signature_date: 'GG.AA.YYYY'
                },
                errors: {
                    min2: 'En az 2 karakter',
                    required: 'Zorunlu',
                    date: 'Format: GG.AA.YYYY',
                    plz: 'Tam 5 rakam',
                    iban: 'GeÃ§erli IBAN girin',
                    bic: '8-11 karakter',
                    select: 'LÃ¼tfen seÃ§in'
                },
                select: {
                    empty: '-- SeÃ§in --',
                    ms: { single: 'Bekar', married: 'Evli', divorced: 'BoÅŸanmÄ±ÅŸ', widowed: 'Dul', separated: 'AyrÄ± yaÅŸÄ±yor', civil_union: 'Medeni birlik' },
                    rel: { none: 'Yok', protestant: 'Protestan', catholic: 'Katolik', orthodox: 'Ortodoks', muslim: 'MÃ¼slÃ¼man', jewish: 'Yahudi', other: 'DiÄŸer' }
                }
            },
            ar: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©', kindergeld: 'Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ù†Ø© Ø§Ù„Ø·ÙÙ„' },
                ui: {
                    restored: 'ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ÙˆØ¯Ø©',
                    clear: 'Ù…Ø³Ø­',
                    incomplete: 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
                    ready: 'Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„',
                    filled: 'Ù…Ù…Ù„ÙˆØ¡:',
                    fields: 'Ø­Ù‚ÙˆÙ„',
                    draft_saved: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©',
                    generating: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...',
                    submit: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯'
                },
                headers: {
                    personal: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',
                    address: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
                    housing: 'Ø§Ù„Ø³ÙƒÙ†',
                    bank: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙÙŠØ©',
                    child: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„',
                    signature: 'Ø§Ù„ØªÙˆÙ‚ÙŠØ¹'
                },
                labels: {
                    first_name: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„',
                    last_name: 'Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©',
                    birth_date: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯',
                    birth_place: 'Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯',
                    nationality: 'Ø§Ù„Ø¬Ù†Ø³ÙŠØ©',
                    marital_status: 'Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
                    religion: 'Ø§Ù„Ø¯ÙŠØ§Ù†Ø©',
                    street: 'Ø§Ù„Ø´Ø§Ø±Ø¹',
                    house_number: 'Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„',
                    postal_code: 'Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ',
                    city: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
                    previous_address: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³Ø§Ø¨Ù‚',
                    move_in_date: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„',
                    landlord_name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨',
                    child_first_name: 'Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø£ÙˆÙ„',
                    child_last_name: 'Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø·ÙÙ„',
                    child_birth_date: 'ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø·ÙÙ„',
                    child_birth_place: 'Ù…ÙƒØ§Ù† Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø·ÙÙ„',
                    child_nationality: 'Ø¬Ù†Ø³ÙŠØ© Ø§Ù„Ø·ÙÙ„',
                    signature_place: 'Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØ¹',
                    signature_date: 'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙ‚ÙŠØ¹'
                },
                placeholders: {
                    first_name: 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø£ÙˆÙ„',
                    last_name: 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„ØªÙƒ',
                    birth_date: 'DD.MM.YYYY',
                    birth_place: 'Ù…Ø«Ø§Ù„: Ø¯Ù…Ø´Ù‚',
                    nationality: 'Ù…Ø«Ø§Ù„: Ø³ÙˆØ±ÙŠ',
                    street: 'Ù…Ø«Ø§Ù„: HauptstraÃŸe',
                    house_number: 'Ù…Ø«Ø§Ù„: 15a',
                    postal_code: '12345',
                    city: 'Ù…Ø«Ø§Ù„: Berlin',
                    previous_address: 'Ù…Ø«Ø§Ù„: Alte StraÃŸe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.YYYY',
                    landlord_name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'Ù…Ø«Ø§Ù„: Max Mustermann',
                    child_first_name: 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„',
                    child_last_name: 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø·ÙÙ„',
                    child_birth_date: 'DD.MM.YYYY',
                    child_birth_place: 'Ù…Ø«Ø§Ù„: Berlin',
                    child_nationality: 'Ù…Ø«Ø§Ù„: Ø£Ù„Ù…Ø§Ù†ÙŠ',
                    signature_place: 'Ù…Ø«Ø§Ù„: Berlin',
                    signature_date: 'DD.MM.YYYY'
                },
                errors: {
                    min2: 'Ø­Ø±ÙØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
                    required: 'Ù…Ø·Ù„ÙˆØ¨',
                    date: 'Ø§Ù„ØµÙŠØºØ©: DD.MM.YYYY',
                    plz: '5 Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·',
                    iban: 'Ø£Ø¯Ø®Ù„ IBAN ØµØ§Ù„Ø­',
                    bic: '8-11 Ø­Ø±Ù',
                    select: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±'
                },
                select: {
                    empty: '-- Ø§Ø®ØªØ± --',
                    ms: { single: 'Ø£Ø¹Ø²Ø¨', married: 'Ù…ØªØ²ÙˆØ¬', divorced: 'Ù…Ø·Ù„Ù‚', widowed: 'Ø£Ø±Ù…Ù„', separated: 'Ù…Ù†ÙØµÙ„', civil_union: 'Ø´Ø±Ø§ÙƒØ© Ù…Ø¯Ù†ÙŠØ©' },
                    rel: { none: 'Ø¨Ø¯ÙˆÙ†', protestant: 'Ø¨Ø±ÙˆØªØ³ØªØ§Ù†Øª', catholic: 'ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ', orthodox: 'Ø£Ø±Ø«ÙˆØ°ÙƒØ³', muslim: 'Ù…Ø³Ù„Ù…', jewish: 'ÙŠÙ‡ÙˆØ¯ÙŠ', other: 'Ø£Ø®Ø±Ù‰' }
                }
            },
            pl: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Rejestracja miejsca zamieszkania', kindergeld: 'Wniosek o zasiÅ‚ek na dziecko' },
                ui: {
                    restored: 'PrzywrÃ³cono wersjÄ™ roboczÄ…',
                    clear: 'WyczyÅ›Ä‡',
                    incomplete: 'ProszÄ™ wypeÅ‚niÄ‡ wymagane pola',
                    ready: 'Formularz gotowy do wysÅ‚ania',
                    filled: 'WypeÅ‚niono:',
                    fields: 'pÃ³l',
                    draft_saved: 'Wersja robocza zapisana',
                    generating: 'Generowanie...',
                    submit: 'Wygeneruj dokument'
                },
                headers: {
                    personal: 'Dane osobowe',
                    address: 'Adres',
                    housing: 'Mieszkanie',
                    bank: 'Dane bankowe',
                    child: 'Dane dziecka',
                    signature: 'Podpis'
                },
                labels: {
                    first_name: 'ImiÄ™',
                    last_name: 'Nazwisko',
                    birth_date: 'Data urodzenia',
                    birth_place: 'Miejsce urodzenia',
                    nationality: 'Obywatelstwo',
                    marital_status: 'Stan cywilny',
                    religion: 'Religia',
                    street: 'Ulica',
                    house_number: 'Numer domu',
                    postal_code: 'Kod pocztowy',
                    city: 'Miasto',
                    previous_address: 'Poprzedni adres',
                    move_in_date: 'Data wprowadzenia',
                    landlord_name: 'ImiÄ™ wynajmujÄ…cego',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'WÅ‚aÅ›ciciel konta',
                    child_first_name: 'ImiÄ™ dziecka',
                    child_last_name: 'Nazwisko dziecka',
                    child_birth_date: 'Data urodzenia dziecka',
                    child_birth_place: 'Miejsce urodzenia dziecka',
                    child_nationality: 'Obywatelstwo dziecka',
                    signature_place: 'Miejsce podpisu',
                    signature_date: 'Data podpisu'
                },
                placeholders: {
                    first_name: 'Wpisz swoje imiÄ™',
                    last_name: 'Wpisz swoje nazwisko',
                    birth_date: 'DD.MM.RRRR',
                    birth_place: 'np. Warszawa',
                    nationality: 'np. polski',
                    street: 'np. HauptstraÃŸe',
                    house_number: 'np. 15a',
                    postal_code: '12345',
                    city: 'np. Berlin',
                    previous_address: 'np. Alte StraÃŸe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.RRRR',
                    landlord_name: 'ImiÄ™ wynajmujÄ…cego',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'np. Max Mustermann',
                    child_first_name: 'Wpisz imiÄ™ dziecka',
                    child_last_name: 'Wpisz nazwisko dziecka',
                    child_birth_date: 'DD.MM.RRRR',
                    child_birth_place: 'np. Berlin',
                    child_nationality: 'np. niemiecki',
                    signature_place: 'np. Berlin',
                    signature_date: 'DD.MM.RRRR'
                },
                errors: {
                    min2: 'Minimum 2 znaki',
                    required: 'Wymagane',
                    date: 'Format: DD.MM.RRRR',
                    plz: 'DokÅ‚adnie 5 cyfr',
                    iban: 'Wpisz poprawny IBAN',
                    bic: '8-11 znakÃ³w',
                    select: 'ProszÄ™ wybraÄ‡'
                },
                select: {
                    empty: '-- Wybierz --',
                    ms: { single: 'Kawaler/Panna', married: 'Å»onaty/ZamÄ™Å¼na', divorced: 'Rozwiedziony/a', widowed: 'Wdowiec/Wdowa', separated: 'W separacji', civil_union: 'ZwiÄ…zek partnerski' },
                    rel: { none: 'Brak', protestant: 'Protestantyzm', catholic: 'Katolicyzm', orthodox: 'PrawosÅ‚awie', muslim: 'Islam', jewish: 'Judaizm', other: 'Inne' }
                }
            }
        };

        function t(path, fallback) {
            var pack = I18N[currentLang] || I18N.ua;
            var parts = path.split('.');
            var cur = pack;
            for (var i = 0; i < parts.length; i++) {
                if (!cur || typeof cur !== 'object') return fallback || path;
                cur = cur[parts[i]];
            }
            return (cur === undefined || cur === null) ? (fallback || path) : cur;
        }

        // ========================================
        // DOC TYPE CONFIG
        // ========================================
        var DOCS = {
            anmeldung: { sections: ['personal', 'address', 'housing', 'signature'], showPreviousAddress: true, showMoveInDate: true },
            kindergeld: { sections: ['personal', 'address', 'bank', 'child', 'signature'], showPreviousAddress: false, showMoveInDate: false }
        };

        if (!DOCS[currentDocType]) currentDocType = 'anmeldung';

        // ========================================
        // DOM
        // ========================================
        var form = document.getElementById('masterForm');
        var submitBtn = document.getElementById('submitBtn');
        var validationStatus = document.getElementById('validationStatus');
        var statusIcon = document.getElementById('statusIcon');
        var statusText = document.getElementById('statusText');
        var filledCountEl = document.getElementById('filledCount');
        var totalCountEl = document.getElementById('totalCount');
        var draftBanner = document.getElementById('draftBanner');
        var clearDraftBtn = document.getElementById('clearDraftBtn');
        var draftStatus = document.getElementById('draftStatus');
        var formTitle = document.getElementById('formTitle');
        var formDescription = document.getElementById('formDescription');

        // ========================================
        // APPLY TRANSLATIONS
        // ========================================
        function setLabelText(labelId, text, isRequired) {
            var label = document.getElementById(labelId);
            if (!label) return;
            var span = label.querySelector('.required');
            label.textContent = text + ' ';
            if (isRequired && span) {
                label.appendChild(span);
            } else if (isRequired) {
                var newSpan = document.createElement('span');
                newSpan.className = 'required';
                newSpan.textContent = '*';
                label.appendChild(newSpan);
            }
        }

        function applyTranslations() {
            formTitle.textContent = t('titles.' + currentDocType, 'Document');
            formDescription.textContent = t('descriptions.' + currentDocType, '');
            document.title = formTitle.textContent;

            document.getElementById('draftBannerText').textContent = t('ui.restored', 'Draft restored');
            document.getElementById('clearDraftBtn').textContent = t('ui.clear', 'Clear');
            document.getElementById('filledText').textContent = t('ui.filled', 'Filled:');
            document.getElementById('fieldsText').textContent = t('ui.fields', 'fields');
            document.getElementById('draftSavedText').textContent = t('ui.draft_saved', 'Draft saved');
            submitBtn.textContent = t('ui.submit', 'Submit');

            document.getElementById('hdr_personal').textContent = t('headers.personal', 'Personal');
            document.getElementById('hdr_address').textContent = t('headers.address', 'Address');
            document.getElementById('hdr_housing').textContent = t('headers.housing', 'Housing');
            document.getElementById('hdr_bank').textContent = t('headers.bank', 'Bank');
            document.getElementById('hdr_child').textContent = t('headers.child', 'Child');
            document.getElementById('hdr_signature').textContent = t('headers.signature', 'Signature');

            var fields = [
                { id: 'first_name', req: true }, { id: 'last_name', req: true }, { id: 'birth_date', req: true },
                { id: 'birth_place', req: true }, { id: 'nationality', req: true }, { id: 'marital_status', req: true },
                { id: 'religion', req: true }, { id: 'street', req: true }, { id: 'house_number', req: true },
                { id: 'postal_code', req: true }, { id: 'city', req: true }, { id: 'previous_address', req: false },
                { id: 'move_in_date', req: true }, { id: 'landlord_name', req: true }, { id: 'iban', req: true },
                { id: 'bic', req: true }, { id: 'account_holder', req: true }, { id: 'child_first_name', req: true },
                { id: 'child_last_name', req: true }, { id: 'child_birth_date', req: true },
                { id: 'child_birth_place', req: true }, { id: 'child_nationality', req: true },
                { id: 'signature_place', req: true }, { id: 'signature_date', req: true }
            ];

            fields.forEach(function(f) {
                setLabelText('lbl_' + f.id, t('labels.' + f.id, f.id), f.req);
                var input = document.getElementById(f.id);
                if (input && input.tagName !== 'SELECT') {
                    input.placeholder = t('placeholders.' + f.id, '');
                }
            });

            document.getElementById('opt_ms_empty').textContent = t('select.empty', '-- Select --');
            document.getElementById('opt_ms_single').textContent = t('select.ms.single', 'Single');
            document.getElementById('opt_ms_married').textContent = t('select.ms.married', 'Married');
            document.getElementById('opt_ms_divorced').textContent = t('select.ms.divorced', 'Divorced');
            document.getElementById('opt_ms_widowed').textContent = t('select.ms.widowed', 'Widowed');
            document.getElementById('opt_ms_separated').textContent = t('select.ms.separated', 'Separated');
            document.getElementById('opt_ms_civil_union').textContent = t('select.ms.civil_union', 'Civil Union');

            document.getElementById('opt_rel_empty').textContent = t('select.empty', '-- Select --');
            document.getElementById('opt_rel_none').textContent = t('select.rel.none', 'None');
            document.getElementById('opt_rel_protestant').textContent = t('select.rel.protestant', 'Protestant');
            document.getElementById('opt_rel_catholic').textContent = t('select.rel.catholic', 'Catholic');
            document.getElementById('opt_rel_orthodox').textContent = t('select.rel.orthodox', 'Orthodox');
            document.getElementById('opt_rel_muslim').textContent = t('select.rel.muslim', 'Muslim');
            document.getElementById('opt_rel_jewish').textContent = t('select.rel.jewish', 'Jewish');
            document.getElementById('opt_rel_other').textContent = t('select.rel.other', 'Other');
        }

        applyTranslations();

        // ========================================
        // SECTIONS
        // ========================================
        var sectionMap = {
            personal: document.getElementById('section_personal'),
            address: document.getElementById('section_address'),
            housing: document.getElementById('section_housing'),
            bank: document.getElementById('section_bank'),
            child: document.getElementById('section_child'),
            signature: document.getElementById('section_signature')
        };

        Object.keys(sectionMap).forEach(function(k) {
            if (sectionMap[k]) sectionMap[k].classList.remove('visible');
        });
        DOCS[currentDocType].sections.forEach(function(k) {
            if (sectionMap[k]) sectionMap[k].classList.add('visible');
        });

        if (!DOCS[currentDocType].showPreviousAddress) {
            var pg = document.getElementById('group_previous_address');
            if (pg) pg.style.display = 'none';
        }
        if (!DOCS[currentDocType].showMoveInDate) {
            var mg = document.getElementById('group_move_in_date');
            if (mg) mg.style.display = 'none';
            var mid = document.getElementById('move_in_date');
            if (mid) mid.setAttribute('data-required', 'false');
        }

        // ========================================
        // ACTIVE FIELDS
        // ========================================
        var isSubmitting = false;
        var saveTimeout = null;
        var activeFields = {};
        var errorHints = {};

        function collectActiveFields() {
            activeFields = {};
            errorHints = {};
            var allControls = form.querySelectorAll('input, select, textarea');
            allControls.forEach(function(ctrl) {
                var sectionEl = ctrl.closest('.form-section');
                if (!sectionEl || !sectionEl.classList.contains('visible')) return;
                var groupEl = ctrl.closest('.form-group');
                if (groupEl && groupEl.style.display === 'none') return;
                activeFields[ctrl.id] = ctrl;
                var hint = document.getElementById('err_' + ctrl.id);
                if (hint) errorHints[ctrl.id] = hint;
            });
            var requiredCount = 0;
            Object.keys(activeFields).forEach(function(id) {
                if (activeFields[id].getAttribute('data-required') === 'true') requiredCount++;
            });
            totalCountEl.textContent = requiredCount;
        }

        collectActiveFields();

        // ========================================
        // VALIDATION
        // ========================================
        function isValidDate(value) {
            if (!value) return false;
            var m = value.match(/^(\d{2})\.(\d{2})\.(\d{4})$/);
            if (!m) return false;
            var d = parseInt(m[1], 10), mo = parseInt(m[2], 10), y = parseInt(m[3], 10);
            return mo >= 1 && mo <= 12 && d >= 1 && d <= 31 && y >= 1900 && y <= 2100;
        }

        function isValidPLZ(value) { return /^\d{5}$/.test(value); }
        function normalizeIBAN(raw) { return (raw || '').toUpperCase().replace(/[^A-Z0-9]/g, ''); }
        function formatIBAN(raw) {
            var v = normalizeIBAN(raw), out = '';
            for (var i = 0; i < v.length; i++) { if (i > 0 && i % 4 === 0) out += ' '; out += v[i]; }
            return out.trim();
        }
        function isValidIBAN(value) {
            var v = normalizeIBAN(value);
            return v.length >= 15 && v.length <= 34 && /^[A-Z]{2}\d{2}[A-Z0-9]+$/.test(v);
        }
        function normalizeBIC(raw) { return (raw || '').toUpperCase().replace(/[^A-Z0-9]/g, ''); }
        function isValidBIC(value) { var v = normalizeBIC(value); return /^[A-Z0-9]{8}([A-Z0-9]{3})?$/.test(v); }

        function formatDateInput(input) {
            var digits = input.value.replace(/[^\d]/g, '');
            var f = '';
            if (digits.length > 0) f = digits.substring(0, 2);
            if (digits.length > 2) f += '.' + digits.substring(2, 4);
            if (digits.length > 4) f += '.' + digits.substring(4, 8);
            input.value = f;
        }

        function validateField(fieldId, showError) {
            var input = activeFields[fieldId];
            if (!input) return true;
            var hint = errorHints[fieldId];
            var value = (input.value || '').trim();
            var format = input.getAttribute('data-format');
            var minLen = parseInt(input.getAttribute('data-min'), 10) || 0;
            var isReq = input.getAttribute('data-required') === 'true';
            var valid = true;

            input.classList.remove('valid', 'invalid');
            if (hint) hint.classList.remove('visible');

            if (!isReq && !value) return true;
            if (isReq && !value) { if (showError) { input.classList.add('invalid'); if (hint) hint.classList.add('visible'); } return false; }

            if (format === 'date') valid = isValidDate(value);
            else if (format === 'plz') valid = isValidPLZ(value);
            else if (format === 'iban') valid = isValidIBAN(value);
            else if (format === 'bic') valid = isValidBIC(value);
            else if (minLen > 0) valid = value.length >= minLen;
            else if (input.tagName === 'SELECT' && isReq) valid = value.length > 0;

            if (valid) input.classList.add('valid');
            else if (showError || value) { input.classList.add('invalid'); if (hint) hint.classList.add('visible'); }
            return valid;
        }

        function canSubmit() {
            var ok = true;
            Object.keys(activeFields).forEach(function(id) {
                var inp = activeFields[id];
                if (inp.getAttribute('data-required') !== 'true') return;
                var v = (inp.value || '').trim();
                var fmt = inp.getAttribute('data-format');
                var minL = parseInt(inp.getAttribute('data-min'), 10) || 0;
                if (!v) ok = false;
                else if (fmt === 'date' && !isValidDate(v)) ok = false;
                else if (fmt === 'plz' && !isValidPLZ(v)) ok = false;
                else if (fmt === 'iban' && !isValidIBAN(v)) ok = false;
                else if (fmt === 'bic' && !isValidBIC(v)) ok = false;
                else if (minL > 0 && v.length < minL) ok = false;
            });
            return ok;
        }

        function updateFieldCounter() {
            var c = 0;
            Object.keys(activeFields).forEach(function(id) {
                if (activeFields[id].getAttribute('data-required') === 'true' && (activeFields[id].value || '').trim()) c++;
            });
            filledCountEl.textContent = c;
        }

        function updateUI() {
            var ok = canSubmit();
            submitBtn.disabled = !ok || isSubmitting;
            if (ok) {
                validationStatus.classList.remove('incomplete');
                validationStatus.classList.add('complete');
                statusIcon.textContent = 'âœ…';
                statusText.textContent = t('ui.ready', 'Ready');
            } else {
                validationStatus.classList.remove('complete');
                validationStatus.classList.add('incomplete');
                statusIcon.textContent = 'âš ï¸';
                statusText.textContent = t('ui.incomplete', 'Fill required fields');
            }
            updateFieldCounter();
        }

        // ========================================
        // DRAFT
        // ========================================
        var DRAFT_KEY = 'draft_' + currentDocType + '_' + currentLang;

        function saveDraft() {
            try {
                var data = {}, hasData = false;
                Object.keys(activeFields).forEach(function(id) {
                    var v = (activeFields[id].value || '').trim();
                    if (v) { data[id] = v; hasData = true; }
                });
                if (hasData) {
                    data._ts = Date.now();
                    localStorage.setItem(DRAFT_KEY, JSON.stringify(data));
                    draftStatus.classList.add('visible');
                } else {
                    localStorage.removeItem(DRAFT_KEY);
                    draftStatus.classList.remove('visible');
                }
            } catch (e) {}
        }

        function debouncedSave() {
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveDraft, 500);
        }

        function loadDraft() {
            try {
                var s = localStorage.getItem(DRAFT_KEY);
                if (!s) return false;
                var data = JSON.parse(s), restored = false;
                Object.keys(activeFields).forEach(function(id) {
                    if (data[id]) { activeFields[id].value = data[id]; restored = true; }
                });
                return restored;
            } catch (e) { return false; }
        }

        function clearDraft() {
            try { localStorage.removeItem(DRAFT_KEY); } catch (e) {}
            Object.keys(activeFields).forEach(function(id) {
                activeFields[id].value = '';
                activeFields[id].classList.remove('valid', 'invalid');
                if (errorHints[id]) errorHints[id].classList.remove('visible');
            });
            draftBanner.classList.remove('visible', 'fade-in');
            draftStatus.classList.remove('visible');
            updateUI();
        }

        clearDraftBtn.addEventListener('click', function(e) { e.preventDefault(); clearDraft(); });

        // ========================================
        // EVENTS
        // ========================================
        Object.keys(activeFields).forEach(function(id) {
            var inp = activeFields[id];
            var fmt = inp.getAttribute('data-format');

            inp.addEventListener('input', function() {
                if (fmt === 'date') formatDateInput(inp);
                else if (fmt === 'plz') inp.value = inp.value.replace(/\D/g, '').slice(0, 5);
                else if (fmt === 'iban') inp.value = formatIBAN(inp.value).slice(0, 42);
                else if (fmt === 'bic') inp.value = normalizeBIC(inp.value).slice(0, 11);
                validateField(id, false);
                updateUI();
                debouncedSave();
            });

            inp.addEventListener('blur', function() {
                var v = (inp.value || '').trim();
                if (v || inp.getAttribute('data-required') === 'true') validateField(id, true);
            });

            if (inp.tagName === 'SELECT') {
                inp.addEventListener('change', function() {
                    validateField(id, false);
                    updateUI();
                    debouncedSave();
                });
            }
        });

        // ========================================
        // SUBMIT (SINGLE HANDLER)
        // ========================================
        submitBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (isSubmitting) return;

            var allValid = true;
            Object.keys(activeFields).forEach(function(id) {
                if (!validateField(id, true)) allValid = false;
            });

            if (!allValid) {
                submitBtn.classList.add('shake');
                setTimeout(function() { submitBtn.classList.remove('shake'); }, 400);
                return;
            }

            isSubmitting = true;
            submitBtn.textContent = t('ui.generating', 'Generating...');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;

            var userAnswers = {};
            Object.keys(activeFields).forEach(function(id) {
                var el = activeFields[id];
                var v = (el.value || '').trim();
                if (!v) return;
                if (el.name === 'iban') v = normalizeIBAN(v);
                if (el.name === 'bic') v = normalizeBIC(v);
                userAnswers[el.name] = v;
            });

            var payload = { doc_type: currentDocType, user_answers: userAnswers };
            console.log('[WebApp] Payload:', payload);

            try { localStorage.removeItem(DRAFT_KEY); } catch (e) {}

            if (tg && tg.sendData) {
                try {
                   tg.sendData(JSON.stringify(payload));
console.log('[WebApp] Data sent to Telegram', payload);

// UI feedback â€” WebApp Ğ·Ğ°Ğ»Ğ¸ÑˆĞ°Ñ”Ñ‚ÑŒÑÑ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸Ğ¼
if (statusText) {
    statusText.textContent = 'â³ Ğ”Ğ°Ğ½Ñ– Ğ½Ğ°Ğ´Ñ–ÑĞ»Ğ°Ğ½Ñ–. ĞÑ‡Ñ–ĞºÑƒÑ Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½Ñ Ğ²Ñ–Ğ´ Ğ±Ğ¾Ñ‚Ğ°...';
}
 
                } catch (err) {
                    console.error('[WebApp] sendData error:', err);
                    isSubmitting = false;
                    submitBtn.textContent = t('ui.submit', 'Submit');
                    submitBtn.classList.remove('loading');
                    updateUI();
                }
            } else {
                console.warn('[WebApp] Not in Telegram context');
                statusIcon.textContent = 'âœ…';
                statusText.textContent = 'Test mode - data ready';
                setTimeout(function() {
                    isSubmitting = false;
                    submitBtn.textContent = t('ui.submit', 'Submit');
                    submitBtn.classList.remove('loading');
                    updateUI();
                }, 2000);
            }
        });

        // ========================================
        // BACK BUTTON
        // ========================================
        if (tg && tg.BackButton) {
            tg.BackButton.show();
            tg.BackButton.onClick(function() { if (tg.close) tg.close(); });
        }

        // ========================================
        // INIT
        // ========================================
        var draftRestored = loadDraft();
        if (draftRestored) {
            draftBanner.classList.add('visible', 'fade-in');
            Object.keys(activeFields).forEach(function(id) { validateField(id, false); });
        }
        updateUI();

        console.log('[WebApp] Ready: doc_type=' + currentDocType + ', lang=' + currentLang);
    })();
    </script>
</body>
   
















