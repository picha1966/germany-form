<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Document Form</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #1a1a1a);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --link-color: var(--tg-theme-link-color, #3390ec);
            --button-color: var(--tg-theme-button-color, #4caf50);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f5f5f5);
            --border-color: #e0e0e0;
            --border-focus: var(--link-color);
            --error-color: #e53935;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --button-disabled: #cccccc;
            --input-bg: var(--secondary-bg);
        }
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px 16px 140px;
        }
        .header {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .header p {
            font-size: 14px;
            color: var(--hint-color);
        }
        .draft-banner {
            background-color: #fff3e0;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: space-between;
            border-left: 3px solid var(--warning-color);
        }
        .draft-banner.visible {
            display: flex;
        }
        .draft-banner-text {
            display: flex;
            align-items: center;
        }
        .draft-banner-text .icon {
            margin-right: 8px;
            font-size: 16px;
        }
        .draft-banner .clear-draft-btn {
            background: none;
            border: none;
            color: var(--error-color);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .draft-banner .clear-draft-btn:active {
            background-color: rgba(229, 57, 53, 0.1);
        }
        @media (prefers-color-scheme: dark) {
            .draft-banner {
                background-color: #3d2e1a;
            }
        }
        .section-header {
            font-size: 13px;
            font-weight: 600;
            color: var(--hint-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            margin-top: 24px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .section-header:first-of-type {
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-color);
        }
        .form-group label .required {
            color: var(--error-color);
            margin-left: 2px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--input-bg);
            color: var(--text-color);
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            -webkit-user-select: text !important;
            user-select: text !important;
            -webkit-touch-callout: default !important;
            touch-action: manipulation;
            -webkit-appearance: none;
            appearance: none;
        }
        .form-group textarea {
            min-height: 90px;
            resize: vertical;
        }
        .form-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
            cursor: pointer;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(51, 144, 236, 0.15);
        }
        .form-group input.valid,
        .form-group select.valid,
        .form-group textarea.valid {
            border-color: var(--success-color);
        }
        .form-group input.invalid,
        .form-group select.invalid,
        .form-group textarea.invalid {
            border-color: var(--error-color);
        }
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--hint-color);
            opacity: 0.8;
        }
        .error-hint {
            font-size: 12px;
            color: var(--error-color);
            margin-top: 4px;
            min-height: 16px;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .error-hint.visible {
            visibility: visible;
            opacity: 1;
        }
        .validation-status {
            background-color: var(--input-bg);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        .validation-status.incomplete {
            border-left: 3px solid var(--error-color);
        }
        .validation-status.complete {
            border-left: 3px solid var(--success-color);
        }
        .validation-status .icon {
            margin-right: 8px;
            font-size: 16px;
        }
        .form-section {
            display: none;
        }
        .form-section.visible {
            display: block;
        }
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: linear-gradient(transparent, var(--bg-color) 30%);
            z-index: 100;
        }
        .submit-btn {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            display: block;
            padding: 16px 24px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        .submit-btn:disabled {
            background-color: var(--button-disabled);
            color: #888888;
            cursor: not-allowed;
        }
        .submit-btn:not(:disabled) {
            background-color: var(--button-color);
            color: var(--button-text-color);
        }
        .submit-btn:not(:disabled):active {
            transform: scale(0.98);
        }
        .submit-btn.loading {
            background-color: var(--hint-color);
            pointer-events: none;
        }
        .form-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            font-size: 13px;
            color: var(--hint-color);
        }
        .draft-status {
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .draft-status.visible {
            opacity: 1;
        }
        .draft-status .icon {
            margin-right: 4px;
            font-size: 12px;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.4s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        @media (max-width: 360px) {
            .container {
                padding: 16px 12px 140px;
            }
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 12px 14px;
                font-size: 15px;
            }
            .header h1 {
                font-size: 20px;
            }
            .draft-banner {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="formTitle">Document Form</h1>
            <p id="formDescription">Fill in the required information</p>
        </div>

        <div class="draft-banner" id="draftBanner">
            <div class="draft-banner-text">
                <span class="icon">üìù</span>
                <span id="draftBannerText">Draft restored</span>
            </div>
            <button type="button" class="clear-draft-btn" id="clearDraftBtn">Clear</button>
        </div>

        <div class="validation-status incomplete" id="validationStatus">
            <span class="icon" id="statusIcon">‚ö†Ô∏è</span>
            <span id="statusText">Fill required fields</span>
        </div>

        <form id="masterForm" autocomplete="off" novalidate>

            <!-- PERSONAL SECTION -->
            <div class="form-section visible" id="section_personal">
                <div class="section-header" id="hdr_personal">Personal Data</div>

                <div class="form-group">
                    <label for="first_name" id="lbl_first_name">First Name <span class="required">*</span></label>
                    <input type="text" id="first_name" name="first_name" placeholder="" autocomplete="given-name" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_first_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="last_name" id="lbl_last_name">Last Name <span class="required">*</span></label>
                    <input type="text" id="last_name" name="last_name" placeholder="" autocomplete="family-name" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_last_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="birth_date" id="lbl_birth_date">Birth Date <span class="required">*</span></label>
                    <input type="text" id="birth_date" name="birth_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="personal" data-required="true" data-format="date">
                    <div class="error-hint" id="err_birth_date">Format: DD.MM.YYYY</div>
                </div>

                <div class="form-group">
                    <label for="birth_place" id="lbl_birth_place">Birth Place <span class="required">*</span></label>
                    <input type="text" id="birth_place" name="birth_place" placeholder="" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_birth_place">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="nationality" id="lbl_nationality">Nationality <span class="required">*</span></label>
                    <input type="text" id="nationality" name="nationality" placeholder="" data-section="personal" data-required="true" data-min="2">
                    <div class="error-hint" id="err_nationality">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="marital_status" id="lbl_marital_status">Marital Status <span class="required">*</span></label>
                    <select id="marital_status" name="marital_status" data-section="personal" data-required="true">
                        <option value="" id="opt_ms_empty">-- Select --</option>
                        <option value="single" id="opt_ms_single">Single</option>
                        <option value="married" id="opt_ms_married">Married</option>
                        <option value="divorced" id="opt_ms_divorced">Divorced</option>
                        <option value="widowed" id="opt_ms_widowed">Widowed</option>
                        <option value="separated" id="opt_ms_separated">Separated</option>
                        <option value="civil_union" id="opt_ms_civil_union">Civil Union</option>
                    </select>
                    <div class="error-hint" id="err_marital_status">Please select</div>
                </div>

                <div class="form-group">
                    <label for="religion" id="lbl_religion">Religion <span class="required">*</span></label>
                    <select id="religion" name="religion" data-section="personal" data-required="true">
                        <option value="" id="opt_rel_empty">-- Select --</option>
                        <option value="none" id="opt_rel_none">None</option>
                        <option value="protestant" id="opt_rel_protestant">Protestant</option>
                        <option value="catholic" id="opt_rel_catholic">Catholic</option>
                        <option value="orthodox" id="opt_rel_orthodox">Orthodox</option>
                        <option value="muslim" id="opt_rel_muslim">Muslim</option>
                        <option value="jewish" id="opt_rel_jewish">Jewish</option>
                        <option value="other" id="opt_rel_other">Other</option>
                    </select>
                    <div class="error-hint" id="err_religion">Please select</div>
                </div>
            </div>

            <!-- ADDRESS SECTION -->
            <div class="form-section" id="section_address">
                <div class="section-header" id="hdr_address">Address</div>

                <div class="form-group">
                    <label for="street" id="lbl_street">Street <span class="required">*</span></label>
                    <input type="text" id="street" name="street" placeholder="" autocomplete="street-address" data-section="address" data-required="true" data-min="2">
                    <div class="error-hint" id="err_street">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="house_number" id="lbl_house_number">House Number <span class="required">*</span></label>
                    <input type="text" id="house_number" name="house_number" placeholder="" data-section="address" data-required="true" data-min="1">
                    <div class="error-hint" id="err_house_number">Required</div>
                </div>

                <div class="form-group">
                    <label for="postal_code" id="lbl_postal_code">Postal Code <span class="required">*</span></label>
                    <input type="text" id="postal_code" name="postal_code" placeholder="12345" inputmode="numeric" maxlength="5" data-section="address" data-required="true" data-format="plz">
                    <div class="error-hint" id="err_postal_code">Exactly 5 digits</div>
                </div>

                <div class="form-group">
                    <label for="city" id="lbl_city">City <span class="required">*</span></label>
                    <input type="text" id="city" name="city" placeholder="" autocomplete="address-level2" data-section="address" data-required="true" data-min="2">
                    <div class="error-hint" id="err_city">Minimum 2 characters</div>
                </div>

                <div class="form-group" id="group_previous_address">
                    <label for="previous_address" id="lbl_previous_address">Previous Address</label>
                    <input type="text" id="previous_address" name="previous_address" placeholder="" data-section="address" data-required="false" data-min="0">
                    <div class="error-hint" id="err_previous_address"></div>
                </div>

                <div class="form-group" id="group_move_in_date">
                    <label for="move_in_date" id="lbl_move_in_date">Move-in Date <span class="required">*</span></label>
                    <input type="text" id="move_in_date" name="move_in_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="address" data-required="true" data-format="date">
                    <div class="error-hint" id="err_move_in_date">Format: DD.MM.YYYY</div>
                </div>
            </div>

            <!-- HOUSING SECTION -->
            <div class="form-section" id="section_housing">
                <div class="section-header" id="hdr_housing">Housing</div>

                <div class="form-group">
                    <label for="landlord_name" id="lbl_landlord_name">Landlord Name <span class="required">*</span></label>
                    <input type="text" id="landlord_name" name="landlord_name" placeholder="" data-section="housing" data-required="true" data-min="2">
                    <div class="error-hint" id="err_landlord_name">Minimum 2 characters</div>
                </div>
            </div>

            <!-- BANK SECTION -->
            <div class="form-section" id="section_bank">
                <div class="section-header" id="hdr_bank">Bank Details</div>

                <div class="form-group">
                    <label for="iban" id="lbl_iban">IBAN <span class="required">*</span></label>
                    <input type="text" id="iban" name="iban" placeholder="DE00 0000 0000 0000 0000 00" inputmode="text" maxlength="42" data-section="bank" data-required="true" data-format="iban">
                    <div class="error-hint" id="err_iban">Enter valid IBAN</div>
                </div>

                <div class="form-group">
                    <label for="bic" id="lbl_bic">BIC <span class="required">*</span></label>
                    <input type="text" id="bic" name="bic" placeholder="COBADEFFXXX" inputmode="text" maxlength="11" data-section="bank" data-required="true" data-format="bic">
                    <div class="error-hint" id="err_bic">8-11 characters</div>
                </div>

                <div class="form-group">
                    <label for="account_holder" id="lbl_account_holder">Account Holder <span class="required">*</span></label>
                    <input type="text" id="account_holder" name="account_holder" placeholder="" data-section="bank" data-required="true" data-min="2">
                    <div class="error-hint" id="err_account_holder">Minimum 2 characters</div>
                </div>
            </div>

            <!-- CHILD SECTION -->
            <div class="form-section" id="section_child">
                <div class="section-header" id="hdr_child">Child Information</div>

                <div class="form-group">
                    <label for="child_first_name" id="lbl_child_first_name">Child First Name <span class="required">*</span></label>
                    <input type="text" id="child_first_name" name="child_first_name" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_first_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="child_last_name" id="lbl_child_last_name">Child Last Name <span class="required">*</span></label>
                    <input type="text" id="child_last_name" name="child_last_name" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_last_name">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="child_birth_date" id="lbl_child_birth_date">Child Birth Date <span class="required">*</span></label>
                    <input type="text" id="child_birth_date" name="child_birth_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="child" data-required="true" data-format="date">
                    <div class="error-hint" id="err_child_birth_date">Format: DD.MM.YYYY</div>
                </div>

                <div class="form-group">
                    <label for="child_birth_place" id="lbl_child_birth_place">Child Birth Place <span class="required">*</span></label>
                    <input type="text" id="child_birth_place" name="child_birth_place" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_birth_place">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="child_nationality" id="lbl_child_nationality">Child Nationality <span class="required">*</span></label>
                    <input type="text" id="child_nationality" name="child_nationality" placeholder="" data-section="child" data-required="true" data-min="2">
                    <div class="error-hint" id="err_child_nationality">Minimum 2 characters</div>
                </div>
            </div>

            <!-- SIGNATURE SECTION -->
            <div class="form-section" id="section_signature">
                <div class="section-header" id="hdr_signature">Signature</div>

                <div class="form-group">
                    <label for="signature_place" id="lbl_signature_place">Signature Place <span class="required">*</span></label>
                    <input type="text" id="signature_place" name="signature_place" placeholder="" data-section="signature" data-required="true" data-min="2">
                    <div class="error-hint" id="err_signature_place">Minimum 2 characters</div>
                </div>

                <div class="form-group">
                    <label for="signature_date" id="lbl_signature_date">Signature Date <span class="required">*</span></label>
                    <input type="text" id="signature_date" name="signature_date" placeholder="DD.MM.YYYY" inputmode="numeric" maxlength="10" data-section="signature" data-required="true" data-format="date">
                    <div class="error-hint" id="err_signature_date">Format: DD.MM.YYYY</div>
                </div>
            </div>

        </form>

        <div class="form-footer">
            <div class="field-counter">
                <span id="filledText">Filled:</span>
                <span id="filledCount">0</span> /
                <span id="totalCount">0</span>
                <span id="fieldsText">fields</span>
            </div>
            <div class="draft-status" id="draftStatus">
                <span class="icon">üíæ</span>
                <span id="draftSavedText">Draft saved</span>
            </div>
        </div>
    </div>

    <div class="submit-container">
        <button type="button" class="submit-btn" id="submitBtn" disabled>Submit</button>
    </div>

    <script>
    (function() {
        'use strict';

        // ========================================
        // URL PARAMS - LANGUAGE ONLY FROM URL
        // ========================================
        function getUrlParams() {
            var params = new URLSearchParams(window.location.search);
            var docType = (params.get('doc_type') || 'anmeldung').toLowerCase();
            var lang = (params.get('lang') || 'ua').toLowerCase();
            
            // Normalize uk -> ua
            if (lang === 'uk') lang = 'ua';
            
            // Supported languages
            var supported = ['ua', 'de', 'en', 'tr', 'ar', 'pl'];
            if (supported.indexOf(lang) === -1) lang = 'ua';
            
            return { docType: docType, lang: lang };
        }

        var PARAMS = getUrlParams();
        var currentDocType = PARAMS.docType;
        var currentLang = PARAMS.lang;

        console.log('[WebApp] doc_type=' + currentDocType + ', lang=' + currentLang);

        // ========================================
        // TELEGRAM WEBAPP - INITIALIZATION DEBUG
        // ========================================
        console.log('[WebApp] ========================================');
        console.log('[WebApp] TELEGRAM WEBAPP INITIALIZATION');
        console.log('[WebApp] ========================================');
        console.log('[WebApp] window.Telegram:', window.Telegram);
        console.log('[WebApp] window.Telegram.WebApp:', window.Telegram ? window.Telegram.WebApp : 'N/A');
        
        var tg = window.Telegram && window.Telegram.WebApp;
        
        if (tg) {
            console.log('[WebApp] ‚úÖ Telegram WebApp API –¥–æ—Å—Ç—É–ø–Ω–∏–π');
            console.log('[WebApp] tg.initData:', tg.initData);
            console.log('[WebApp] tg.initDataUnsafe:', tg.initDataUnsafe);
            console.log('[WebApp] tg.platform:', tg.platform);
            console.log('[WebApp] tg.version:', tg.version);
            console.log('[WebApp] tg.sendData function:', typeof tg.sendData);
            
            tg.ready();
            tg.expand();
            
            console.log('[WebApp] ‚úÖ tg.ready() —Ç–∞ tg.expand() –≤–∏–∫–ª–∏–∫–∞–Ω–æ');
        } else {
            console.warn('[WebApp] ‚ö†Ô∏è Telegram WebApp API –ù–ï –¥–æ—Å—Ç—É–ø–Ω–∏–π!');
            console.warn('[WebApp] –¶–µ –æ–∑–Ω–∞—á–∞—î —â–æ WebApp –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –Ω–µ —á–µ—Ä–µ–∑ Telegram');
        }
        console.log('[WebApp] ========================================');

        // ========================================
        // I18N TRANSLATIONS
        // ========================================
        var I18N = {
            ua: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –º—ñ—Å—Ü–µ–º –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è', kindergeld: '–ó–∞—è–≤–∞ –Ω–∞ –¥–æ–ø–æ–º–æ–≥—É –Ω–∞ –¥—ñ—Ç–µ–π' },
                ui: {
                    restored: '–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω—É –∞–Ω–∫–µ—Ç—É',
                    clear: '–û—á–∏—Å—Ç–∏—Ç–∏',
                    incomplete: "–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è",
                    ready: '–§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏',
                    filled: '–ó–∞–ø–æ–≤–Ω–µ–Ω–æ:',
                    fields: '–ø–æ–ª—ñ–≤',
                    draft_saved: '–ß–µ—Ä–Ω–µ—Ç–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞',
                    generating: '–ì–µ–Ω–µ—Ä—É—î–º–æ...',
                    submit: '–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç'
                },
                headers: {
                    personal: '–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ',
                    address: '–ê–¥—Ä–µ—Å–∞',
                    housing: '–ñ–∏—Ç–ª–æ',
                    bank: '–ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏',
                    child: '–î–∞–Ω—ñ –¥–∏—Ç–∏–Ω–∏',
                    signature: '–ü—ñ–¥–ø–∏—Å'
                },
                labels: {
                    first_name: "–Ü–º'—è",
                    last_name: '–ü—Ä—ñ–∑–≤–∏—â–µ',
                    birth_date: '–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è',
                    birth_place: '–ú—ñ—Å—Ü–µ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è',
                    nationality: '–ì—Ä–æ–º–∞–¥—è–Ω—Å—Ç–≤–æ',
                    marital_status: '–°—ñ–º–µ–π–Ω–∏–π —Å—Ç–∞–Ω',
                    religion: '–í—ñ—Ä–æ—Å–ø–æ–≤—ñ–¥–∞–Ω–Ω—è',
                    street: '–í—É–ª–∏—Ü—è',
                    house_number: '–ù–æ–º–µ—Ä –±—É–¥–∏–Ω–∫—É',
                    postal_code: '–ü–æ—à—Ç–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å',
                    city: '–ú—ñ—Å—Ç–æ',
                    previous_address: '–ü–æ–ø–µ—Ä–µ–¥–Ω—è –∞–¥—Ä–µ—Å–∞',
                    move_in_date: '–î–∞—Ç–∞ –∑–∞—ó–∑–¥—É',
                    landlord_name: '–û—Ä–µ–Ω–¥–æ–¥–∞–≤–µ—Ü—å (–ü–Ü–ë)',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: '–í–ª–∞—Å–Ω–∏–∫ —Ä–∞—Ö—É–Ω–∫—É',
                    child_first_name: "–Ü–º'—è –¥–∏—Ç–∏–Ω–∏",
                    child_last_name: '–ü—Ä—ñ–∑–≤–∏—â–µ –¥–∏—Ç–∏–Ω–∏',
                    child_birth_date: '–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –¥–∏—Ç–∏–Ω–∏',
                    child_birth_place: '–ú—ñ—Å—Ü–µ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –¥–∏—Ç–∏–Ω–∏',
                    child_nationality: '–ì—Ä–æ–º–∞–¥—è–Ω—Å—Ç–≤–æ –¥–∏—Ç–∏–Ω–∏',
                    signature_place: '–ú—ñ—Å—Ç–æ –ø—ñ–¥–ø–∏—Å—É',
                    signature_date: '–î–∞—Ç–∞ –ø—ñ–¥–ø–∏—Å—É'
                },
                placeholders: {
                    first_name: "–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è",
                    last_name: '–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ',
                    birth_date: 'DD.MM.YYYY',
                    birth_place: '–Ω–∞–ø—Ä., –ö–∏—ó–≤',
                    nationality: '–Ω–∞–ø—Ä., ukrainisch',
                    street: '–Ω–∞–ø—Ä., Hauptstra√üe',
                    house_number: '–Ω–∞–ø—Ä., 15a',
                    postal_code: '12345',
                    city: '–Ω–∞–ø—Ä., Berlin',
                    previous_address: '–Ω–∞–ø—Ä., Alte Stra√üe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.YYYY',
                    landlord_name: "–Ü–º'—è –æ—Ä–µ–Ω–¥–æ–¥–∞–≤—Ü—è",
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: '–Ω–∞–ø—Ä., Max Mustermann',
                    child_first_name: "–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –¥–∏—Ç–∏–Ω–∏",
                    child_last_name: '–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ –¥–∏—Ç–∏–Ω–∏',
                    child_birth_date: 'DD.MM.YYYY',
                    child_birth_place: '–Ω–∞–ø—Ä., Berlin',
                    child_nationality: '–Ω–∞–ø—Ä., deutsch',
                    signature_place: '–Ω–∞–ø—Ä., Berlin',
                    signature_date: 'DD.MM.YYYY'
                },
                errors: {
                    min2: '–ú—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏',
                    required: "–û–±–æ–≤'—è–∑–∫–æ–≤–µ –ø–æ–ª–µ",
                    date: '–§–æ—Ä–º–∞—Ç: DD.MM.YYYY',
                    plz: '–†—ñ–≤–Ω–æ 5 —Ü–∏—Ñ—Ä',
                    iban: '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π IBAN',
                    bic: '8-11 —Å–∏–º–≤–æ–ª—ñ–≤',
                    select: '–û–±–µ—Ä—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è'
                },
                select: {
                    empty: '-- –û–±—Ä–∞—Ç–∏ --',
                    ms: { single: '–ù–µ–æ–¥—Ä—É–∂–µ–Ω–∏–π/–Ω–µ–æ–¥—Ä—É–∂–µ–Ω–∞', married: '–û–¥—Ä—É–∂–µ–Ω–∏–π/–∑–∞–º—ñ–∂–Ω—è', divorced: '–†–æ–∑–ª—É—á–µ–Ω–∏–π/—Ä–æ–∑–ª—É—á–µ–Ω–∞', widowed: '–í–¥—ñ–≤–µ—Ü—å/–≤–¥–æ–≤–∞', separated: '–û–∫—Ä–µ–º–æ –ø—Ä–æ–∂–∏–≤–∞—î', civil_union: '–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ' },
                    rel: { none: '–ù–µ–º–∞—î', protestant: '–ü—Ä–æ—Ç–µ—Å—Ç–∞–Ω—Ç', catholic: '–ö–∞—Ç–æ–ª–∏–∫', orthodox: '–ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–∏–π', muslim: '–ú—É—Å—É–ª—å–º–∞–Ω–∏–Ω', jewish: '–Æ–¥–µ–π', other: '–Ü–Ω—à–µ' }
                }
            },
            de: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Wohnsitz registrieren', kindergeld: 'Antrag auf Kindergeld' },
                ui: {
                    restored: 'Entwurf wiederhergestellt',
                    clear: 'L√∂schen',
                    incomplete: 'Bitte Pflichtfelder ausf√ºllen',
                    ready: 'Bereit zum Senden',
                    filled: 'Ausgef√ºllt:',
                    fields: 'Felder',
                    draft_saved: 'Entwurf gespeichert',
                    generating: 'Erstelle...',
                    submit: 'Dokument erstellen'
                },
                headers: {
                    personal: 'Pers√∂nliche Daten',
                    address: 'Adresse',
                    housing: 'Wohnung',
                    bank: 'Bankdaten',
                    child: 'Kind',
                    signature: 'Unterschrift'
                },
                labels: {
                    first_name: 'Vorname',
                    last_name: 'Nachname',
                    birth_date: 'Geburtsdatum',
                    birth_place: 'Geburtsort',
                    nationality: 'Staatsangeh√∂rigkeit',
                    marital_status: 'Familienstand',
                    religion: 'Religion',
                    street: 'Stra√üe',
                    house_number: 'Hausnummer',
                    postal_code: 'PLZ',
                    city: 'Ort',
                    previous_address: 'Bisherige Anschrift',
                    move_in_date: 'Einzugsdatum',
                    landlord_name: 'Wohnungsgeber (Name)',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Kontoinhaber',
                    child_first_name: 'Vorname des Kindes',
                    child_last_name: 'Nachname des Kindes',
                    child_birth_date: 'Geburtsdatum des Kindes',
                    child_birth_place: 'Geburtsort des Kindes',
                    child_nationality: 'Staatsangeh√∂rigkeit des Kindes',
                    signature_place: 'Ort (Unterschrift)',
                    signature_date: 'Datum (Unterschrift)'
                },
                placeholders: {
                    first_name: 'Geben Sie Ihren Vornamen ein',
                    last_name: 'Geben Sie Ihren Nachnamen ein',
                    birth_date: 'TT.MM.JJJJ',
                    birth_place: 'z.B., Berlin',
                    nationality: 'z.B., deutsch',
                    street: 'z.B., Hauptstra√üe',
                    house_number: 'z.B., 15a',
                    postal_code: '12345',
                    city: 'z.B., Berlin',
                    previous_address: 'z.B., Alte Stra√üe 15, 10117 Berlin',
                    move_in_date: 'TT.MM.JJJJ',
                    landlord_name: 'Name des Wohnungsgebers',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'z.B., Max Mustermann',
                    child_first_name: 'Vorname des Kindes eingeben',
                    child_last_name: 'Nachname des Kindes eingeben',
                    child_birth_date: 'TT.MM.JJJJ',
                    child_birth_place: 'z.B., Berlin',
                    child_nationality: 'z.B., deutsch',
                    signature_place: 'z.B., Berlin',
                    signature_date: 'TT.MM.JJJJ'
                },
                errors: {
                    min2: 'Mindestens 2 Zeichen',
                    required: 'Pflichtfeld',
                    date: 'Format: TT.MM.JJJJ',
                    plz: 'Genau 5 Ziffern',
                    iban: 'Geben Sie eine g√ºltige IBAN ein',
                    bic: '8-11 Zeichen',
                    select: 'Bitte ausw√§hlen'
                },
                select: {
                    empty: '-- Ausw√§hlen --',
                    ms: { single: 'Ledig', married: 'Verheiratet', divorced: 'Geschieden', widowed: 'Verwitwet', separated: 'Getrennt lebend', civil_union: 'Eingetragene Partnerschaft' },
                    rel: { none: 'Keine', protestant: 'Evangelisch', catholic: 'Katholisch', orthodox: 'Orthodox', muslim: 'Muslimisch', jewish: 'J√ºdisch', other: 'Andere' }
                }
            },
            en: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Residence registration', kindergeld: 'Child benefit application' },
                ui: {
                    restored: 'Draft restored',
                    clear: 'Clear',
                    incomplete: 'Please fill required fields',
                    ready: 'Form ready to submit',
                    filled: 'Filled:',
                    fields: 'fields',
                    draft_saved: 'Draft saved',
                    generating: 'Generating...',
                    submit: 'Generate document'
                },
                headers: {
                    personal: 'Personal Data',
                    address: 'Address',
                    housing: 'Housing',
                    bank: 'Bank Details',
                    child: 'Child Information',
                    signature: 'Signature'
                },
                labels: {
                    first_name: 'First Name',
                    last_name: 'Last Name',
                    birth_date: 'Birth Date',
                    birth_place: 'Birth Place',
                    nationality: 'Nationality',
                    marital_status: 'Marital Status',
                    religion: 'Religion',
                    street: 'Street',
                    house_number: 'House Number',
                    postal_code: 'Postal Code',
                    city: 'City',
                    previous_address: 'Previous Address',
                    move_in_date: 'Move-in Date',
                    landlord_name: 'Landlord Name',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Account Holder',
                    child_first_name: 'Child First Name',
                    child_last_name: 'Child Last Name',
                    child_birth_date: 'Child Birth Date',
                    child_birth_place: 'Child Birth Place',
                    child_nationality: 'Child Nationality',
                    signature_place: 'Signature Place',
                    signature_date: 'Signature Date'
                },
                placeholders: {
                    first_name: 'Enter your first name',
                    last_name: 'Enter your last name',
                    birth_date: 'DD.MM.YYYY',
                    birth_place: 'e.g., Kyiv',
                    nationality: 'e.g., Ukrainian',
                    street: 'e.g., Hauptstra√üe',
                    house_number: 'e.g., 15a',
                    postal_code: '12345',
                    city: 'e.g., Berlin',
                    previous_address: 'e.g., Alte Stra√üe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.YYYY',
                    landlord_name: 'Name of landlord',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'e.g., Max Mustermann',
                    child_first_name: 'Enter child first name',
                    child_last_name: 'Enter child last name',
                    child_birth_date: 'DD.MM.YYYY',
                    child_birth_place: 'e.g., Berlin',
                    child_nationality: 'e.g., German',
                    signature_place: 'e.g., Berlin',
                    signature_date: 'DD.MM.YYYY'
                },
                errors: {
                    min2: 'Minimum 2 characters',
                    required: 'Required',
                    date: 'Format: DD.MM.YYYY',
                    plz: 'Exactly 5 digits',
                    iban: 'Enter valid IBAN',
                    bic: '8-11 characters',
                    select: 'Please select'
                },
                select: {
                    empty: '-- Select --',
                    ms: { single: 'Single', married: 'Married', divorced: 'Divorced', widowed: 'Widowed', separated: 'Separated', civil_union: 'Civil Union' },
                    rel: { none: 'None', protestant: 'Protestant', catholic: 'Catholic', orthodox: 'Orthodox', muslim: 'Muslim', jewish: 'Jewish', other: 'Other' }
                }
            },
            tr: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'ƒ∞kamet kaydƒ±', kindergeld: '√áocuk parasƒ± ba≈üvurusu' },
                ui: {
                    restored: 'Taslak geri y√ºklendi',
                    clear: 'Temizle',
                    incomplete: 'L√ºtfen zorunlu alanlarƒ± doldurun',
                    ready: 'Form g√∂nderilmeye hazƒ±r',
                    filled: 'Dolduruldu:',
                    fields: 'alan',
                    draft_saved: 'Taslak kaydedildi',
                    generating: 'Olu≈üturuluyor...',
                    submit: 'Belge olu≈ütur'
                },
                headers: {
                    personal: 'Ki≈üisel Bilgiler',
                    address: 'Adres',
                    housing: 'Konut',
                    bank: 'Banka Bilgileri',
                    child: '√áocuk Bilgileri',
                    signature: 'ƒ∞mza'
                },
                labels: {
                    first_name: 'Ad',
                    last_name: 'Soyad',
                    birth_date: 'Doƒüum Tarihi',
                    birth_place: 'Doƒüum Yeri',
                    nationality: 'Uyruk',
                    marital_status: 'Medeni Durum',
                    religion: 'Din',
                    street: 'Sokak',
                    house_number: 'Ev Numarasƒ±',
                    postal_code: 'Posta Kodu',
                    city: '≈ûehir',
                    previous_address: '√ñnceki Adres',
                    move_in_date: 'Ta≈üƒ±nma Tarihi',
                    landlord_name: 'Ev Sahibi Adƒ±',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'Hesap Sahibi',
                    child_first_name: '√áocuƒüun Adƒ±',
                    child_last_name: '√áocuƒüun Soyadƒ±',
                    child_birth_date: '√áocuƒüun Doƒüum Tarihi',
                    child_birth_place: '√áocuƒüun Doƒüum Yeri',
                    child_nationality: '√áocuƒüun Uyruƒüu',
                    signature_place: 'ƒ∞mza Yeri',
                    signature_date: 'ƒ∞mza Tarihi'
                },
                placeholders: {
                    first_name: 'Adƒ±nƒ±zƒ± girin',
                    last_name: 'Soyadƒ±nƒ±zƒ± girin',
                    birth_date: 'GG.AA.YYYY',
                    birth_place: '√∂rn., ƒ∞stanbul',
                    nationality: '√∂rn., T√ºrk',
                    street: '√∂rn., Hauptstra√üe',
                    house_number: '√∂rn., 15a',
                    postal_code: '12345',
                    city: '√∂rn., Berlin',
                    previous_address: '√∂rn., Alte Stra√üe 15, 10117 Berlin',
                    move_in_date: 'GG.AA.YYYY',
                    landlord_name: 'Ev sahibinin adƒ±',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: '√∂rn., Max Mustermann',
                    child_first_name: '√áocuƒüun adƒ±nƒ± girin',
                    child_last_name: '√áocuƒüun soyadƒ±nƒ± girin',
                    child_birth_date: 'GG.AA.YYYY',
                    child_birth_place: '√∂rn., Berlin',
                    child_nationality: '√∂rn., Alman',
                    signature_place: '√∂rn., Berlin',
                    signature_date: 'GG.AA.YYYY'
                },
                errors: {
                    min2: 'En az 2 karakter',
                    required: 'Zorunlu',
                    date: 'Format: GG.AA.YYYY',
                    plz: 'Tam 5 rakam',
                    iban: 'Ge√ßerli IBAN girin',
                    bic: '8-11 karakter',
                    select: 'L√ºtfen se√ßin'
                },
                select: {
                    empty: '-- Se√ßin --',
                    ms: { single: 'Bekar', married: 'Evli', divorced: 'Bo≈üanmƒ±≈ü', widowed: 'Dul', separated: 'Ayrƒ± ya≈üƒ±yor', civil_union: 'Medeni birlik' },
                    rel: { none: 'Yok', protestant: 'Protestan', catholic: 'Katolik', orthodox: 'Ortodoks', muslim: 'M√ºsl√ºman', jewish: 'Yahudi', other: 'Diƒüer' }
                }
            },
            ar: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÇÿßŸÖÿ©', kindergeld: 'ÿ∑ŸÑÿ® ÿ•ÿπÿßŸÜÿ© ÿßŸÑÿ∑ŸÅŸÑ' },
                ui: {
                    restored: 'ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≥ŸàÿØÿ©',
                    clear: 'ŸÖÿ≥ÿ≠',
                    incomplete: 'Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©',
                    ready: 'ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ•ÿ±ÿ≥ÿßŸÑ',
                    filled: 'ŸÖŸÖŸÑŸàÿ°:',
                    fields: 'ÿ≠ŸÇŸàŸÑ',
                    draft_saved: 'ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ŸàÿØÿ©',
                    generating: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°...',
                    submit: 'ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ'
                },
                headers: {
                    personal: 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©',
                    address: 'ÿßŸÑÿπŸÜŸàÿßŸÜ',
                    housing: 'ÿßŸÑÿ≥ŸÉŸÜ',
                    bank: 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿµÿ±ŸÅŸäÿ©',
                    child: 'ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÅŸÑ',
                    signature: 'ÿßŸÑÿ™ŸàŸÇŸäÿπ'
                },
                labels: {
                    first_name: 'ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ£ŸàŸÑ',
                    last_name: 'ÿßÿ≥ŸÖ ÿßŸÑÿπÿßÿ¶ŸÑÿ©',
                    birth_date: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ',
                    birth_place: 'ŸÖŸÉÿßŸÜ ÿßŸÑŸÖŸäŸÑÿßÿØ',
                    nationality: 'ÿßŸÑÿ¨ŸÜÿ≥Ÿäÿ©',
                    marital_status: 'ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸäÿ©',
                    religion: 'ÿßŸÑÿØŸäÿßŸÜÿ©',
                    street: 'ÿßŸÑÿ¥ÿßÿ±ÿπ',
                    house_number: 'ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÜÿ≤ŸÑ',
                    postal_code: 'ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ®ÿ±ŸäÿØŸä',
                    city: 'ÿßŸÑŸÖÿØŸäŸÜÿ©',
                    previous_address: 'ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑÿ≥ÿßÿ®ŸÇ',
                    move_in_date: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ',
                    landlord_name: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßŸÑŸÉ',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'ÿµÿßÿ≠ÿ® ÿßŸÑÿ≠ÿ≥ÿßÿ®',
                    child_first_name: 'ÿßÿ≥ŸÖ ÿßŸÑÿ∑ŸÅŸÑ ÿßŸÑÿ£ŸàŸÑ',
                    child_last_name: 'ÿßÿ≥ŸÖ ÿπÿßÿ¶ŸÑÿ© ÿßŸÑÿ∑ŸÅŸÑ',
                    child_birth_date: 'ÿ™ÿßÿ±ŸäÿÆ ŸÖŸäŸÑÿßÿØ ÿßŸÑÿ∑ŸÅŸÑ',
                    child_birth_place: 'ŸÖŸÉÿßŸÜ ŸÖŸäŸÑÿßÿØ ÿßŸÑÿ∑ŸÅŸÑ',
                    child_nationality: 'ÿ¨ŸÜÿ≥Ÿäÿ© ÿßŸÑÿ∑ŸÅŸÑ',
                    signature_place: 'ŸÖŸÉÿßŸÜ ÿßŸÑÿ™ŸàŸÇŸäÿπ',
                    signature_date: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ŸàŸÇŸäÿπ'
                },
                placeholders: {
                    first_name: 'ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ÿßŸÑÿ£ŸàŸÑ',
                    last_name: 'ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿπÿßÿ¶ŸÑÿ™ŸÉ',
                    birth_date: 'DD.MM.YYYY',
                    birth_place: 'ŸÖÿ´ÿßŸÑ: ÿØŸÖÿ¥ŸÇ',
                    nationality: 'ŸÖÿ´ÿßŸÑ: ÿ≥Ÿàÿ±Ÿä',
                    street: 'ŸÖÿ´ÿßŸÑ: Hauptstra√üe',
                    house_number: 'ŸÖÿ´ÿßŸÑ: 15a',
                    postal_code: '12345',
                    city: 'ŸÖÿ´ÿßŸÑ: Berlin',
                    previous_address: 'ŸÖÿ´ÿßŸÑ: Alte Stra√üe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.YYYY',
                    landlord_name: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßŸÑŸÉ',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'ŸÖÿ´ÿßŸÑ: Max Mustermann',
                    child_first_name: 'ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ŸÅŸÑ',
                    child_last_name: 'ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿπÿßÿ¶ŸÑÿ© ÿßŸÑÿ∑ŸÅŸÑ',
                    child_birth_date: 'DD.MM.YYYY',
                    child_birth_place: 'ŸÖÿ´ÿßŸÑ: Berlin',
                    child_nationality: 'ŸÖÿ´ÿßŸÑ: ÿ£ŸÑŸÖÿßŸÜŸä',
                    signature_place: 'ŸÖÿ´ÿßŸÑ: Berlin',
                    signature_date: 'DD.MM.YYYY'
                },
                errors: {
                    min2: 'ÿ≠ÿ±ŸÅÿßŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ',
                    required: 'ŸÖÿ∑ŸÑŸàÿ®',
                    date: 'ÿßŸÑÿµŸäÿ∫ÿ©: DD.MM.YYYY',
                    plz: '5 ÿ£ÿ±ŸÇÿßŸÖ ÿ®ÿßŸÑÿ∂ÿ®ÿ∑',
                    iban: 'ÿ£ÿØÿÆŸÑ IBAN ÿµÿßŸÑÿ≠',
                    bic: '8-11 ÿ≠ÿ±ŸÅ',
                    select: 'Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±'
                },
                select: {
                    empty: '-- ÿßÿÆÿ™ÿ± --',
                    ms: { single: 'ÿ£ÿπÿ≤ÿ®', married: 'ŸÖÿ™ÿ≤Ÿàÿ¨', divorced: 'ŸÖÿ∑ŸÑŸÇ', widowed: 'ÿ£ÿ±ŸÖŸÑ', separated: 'ŸÖŸÜŸÅÿµŸÑ', civil_union: 'ÿ¥ÿ±ÿßŸÉÿ© ŸÖÿØŸÜŸäÿ©' },
                    rel: { none: 'ÿ®ÿØŸàŸÜ', protestant: 'ÿ®ÿ±Ÿàÿ™ÿ≥ÿ™ÿßŸÜÿ™', catholic: 'ŸÉÿßÿ´ŸàŸÑŸäŸÉ', orthodox: 'ÿ£ÿ±ÿ´Ÿàÿ∞ŸÉÿ≥', muslim: 'ŸÖÿ≥ŸÑŸÖ', jewish: 'ŸäŸáŸàÿØŸä', other: 'ÿ£ÿÆÿ±Ÿâ' }
                }
            },
            pl: {
                titles: { anmeldung: 'Anmeldung', kindergeld: 'Kindergeld' },
                descriptions: { anmeldung: 'Rejestracja miejsca zamieszkania', kindergeld: 'Wniosek o zasi≈Çek na dziecko' },
                ui: {
                    restored: 'Przywr√≥cono wersjƒô roboczƒÖ',
                    clear: 'Wyczy≈õƒá',
                    incomplete: 'Proszƒô wype≈Çniƒá wymagane pola',
                    ready: 'Formularz gotowy do wys≈Çania',
                    filled: 'Wype≈Çniono:',
                    fields: 'p√≥l',
                    draft_saved: 'Wersja robocza zapisana',
                    generating: 'Generowanie...',
                    submit: 'Wygeneruj dokument'
                },
                headers: {
                    personal: 'Dane osobowe',
                    address: 'Adres',
                    housing: 'Mieszkanie',
                    bank: 'Dane bankowe',
                    child: 'Dane dziecka',
                    signature: 'Podpis'
                },
                labels: {
                    first_name: 'Imiƒô',
                    last_name: 'Nazwisko',
                    birth_date: 'Data urodzenia',
                    birth_place: 'Miejsce urodzenia',
                    nationality: 'Obywatelstwo',
                    marital_status: 'Stan cywilny',
                    religion: 'Religia',
                    street: 'Ulica',
                    house_number: 'Numer domu',
                    postal_code: 'Kod pocztowy',
                    city: 'Miasto',
                    previous_address: 'Poprzedni adres',
                    move_in_date: 'Data wprowadzenia',
                    landlord_name: 'Imiƒô wynajmujƒÖcego',
                    iban: 'IBAN',
                    bic: 'BIC',
                    account_holder: 'W≈Ça≈õciciel konta',
                    child_first_name: 'Imiƒô dziecka',
                    child_last_name: 'Nazwisko dziecka',
                    child_birth_date: 'Data urodzenia dziecka',
                    child_birth_place: 'Miejsce urodzenia dziecka',
                    child_nationality: 'Obywatelstwo dziecka',
                    signature_place: 'Miejsce podpisu',
                    signature_date: 'Data podpisu'
                },
                placeholders: {
                    first_name: 'Wpisz swoje imiƒô',
                    last_name: 'Wpisz swoje nazwisko',
                    birth_date: 'DD.MM.RRRR',
                    birth_place: 'np. Warszawa',
                    nationality: 'np. polski',
                    street: 'np. Hauptstra√üe',
                    house_number: 'np. 15a',
                    postal_code: '12345',
                    city: 'np. Berlin',
                    previous_address: 'np. Alte Stra√üe 15, 10117 Berlin',
                    move_in_date: 'DD.MM.RRRR',
                    landlord_name: 'Imiƒô wynajmujƒÖcego',
                    iban: 'DE00 0000 0000 0000 0000 00',
                    bic: 'COBADEFFXXX',
                    account_holder: 'np. Max Mustermann',
                    child_first_name: 'Wpisz imiƒô dziecka',
                    child_last_name: 'Wpisz nazwisko dziecka',
                    child_birth_date: 'DD.MM.RRRR',
                    child_birth_place: 'np. Berlin',
                    child_nationality: 'np. niemiecki',
                    signature_place: 'np. Berlin',
                    signature_date: 'DD.MM.RRRR'
                },
                errors: {
                    min2: 'Minimum 2 znaki',
                    required: 'Wymagane',
                    date: 'Format: DD.MM.RRRR',
                    plz: 'Dok≈Çadnie 5 cyfr',
                    iban: 'Wpisz poprawny IBAN',
                    bic: '8-11 znak√≥w',
                    select: 'Proszƒô wybraƒá'
                },
                select: {
                    empty: '-- Wybierz --',
                    ms: { single: 'Kawaler/Panna', married: '≈ªonaty/Zamƒô≈ºna', divorced: 'Rozwiedziony/a', widowed: 'Wdowiec/Wdowa', separated: 'W separacji', civil_union: 'ZwiƒÖzek partnerski' },
                    rel: { none: 'Brak', protestant: 'Protestantyzm', catholic: 'Katolicyzm', orthodox: 'Prawos≈Çawie', muslim: 'Islam', jewish: 'Judaizm', other: 'Inne' }
                }
            }
        };

        function t(path, fallback) {
            var pack = I18N[currentLang] || I18N.ua;
            var parts = path.split('.');
            var cur = pack;
            for (var i = 0; i < parts.length; i++) {
                if (!cur || typeof cur !== 'object') return fallback || path;
                cur = cur[parts[i]];
            }
            return (cur === undefined || cur === null) ? (fallback || path) : cur;
        }

        // ========================================
        // DOC TYPE CONFIG
        // ========================================
        var DOCS = {
            anmeldung: { sections: ['personal', 'address', 'housing', 'signature'], showPreviousAddress: true, showMoveInDate: true },
            kindergeld: { sections: ['personal', 'address', 'bank', 'child', 'signature'], showPreviousAddress: false, showMoveInDate: false }
        };

        if (!DOCS[currentDocType]) currentDocType = 'anmeldung';

        // ========================================
        // DOM
        // ========================================
        var form = document.getElementById('masterForm');
        var submitBtn = document.getElementById('submitBtn');
        var validationStatus = document.getElementById('validationStatus');
        var statusIcon = document.getElementById('statusIcon');
        var statusText = document.getElementById('statusText');
        var filledCountEl = document.getElementById('filledCount');
        var totalCountEl = document.getElementById('totalCount');
        var draftBanner = document.getElementById('draftBanner');
        var clearDraftBtn = document.getElementById('clearDraftBtn');
        var draftStatus = document.getElementById('draftStatus');
        var formTitle = document.getElementById('formTitle');
        var formDescription = document.getElementById('formDescription');

        // ========================================
        // APPLY TRANSLATIONS
        // ========================================
        function setLabelText(labelId, text, isRequired) {
            var label = document.getElementById(labelId);
            if (!label) return;
            var span = label.querySelector('.required');
            label.textContent = text + ' ';
            if (isRequired && span) {
                label.appendChild(span);
            } else if (isRequired) {
                var newSpan = document.createElement('span');
                newSpan.className = 'required';
                newSpan.textContent = '*';
                label.appendChild(newSpan);
            }
        }

        function applyTranslations() {
            formTitle.textContent = t('titles.' + currentDocType, 'Document');
            formDescription.textContent = t('descriptions.' + currentDocType, '');
            document.title = formTitle.textContent;

            document.getElementById('draftBannerText').textContent = t('ui.restored', 'Draft restored');
            document.getElementById('clearDraftBtn').textContent = t('ui.clear', 'Clear');
            document.getElementById('filledText').textContent = t('ui.filled', 'Filled:');
            document.getElementById('fieldsText').textContent = t('ui.fields', 'fields');
            document.getElementById('draftSavedText').textContent = t('ui.draft_saved', 'Draft saved');
            submitBtn.textContent = t('ui.submit', 'Submit');

            document.getElementById('hdr_personal').textContent = t('headers.personal', 'Personal');
            document.getElementById('hdr_address').textContent = t('headers.address', 'Address');
            document.getElementById('hdr_housing').textContent = t('headers.housing', 'Housing');
            document.getElementById('hdr_bank').textContent = t('headers.bank', 'Bank');
            document.getElementById('hdr_child').textContent = t('headers.child', 'Child');
            document.getElementById('hdr_signature').textContent = t('headers.signature', 'Signature');

            var fields = [
                { id: 'first_name', req: true }, { id: 'last_name', req: true }, { id: 'birth_date', req: true },
                { id: 'birth_place', req: true }, { id: 'nationality', req: true }, { id: 'marital_status', req: true },
                { id: 'religion', req: true }, { id: 'street', req: true }, { id: 'house_number', req: true },
                { id: 'postal_code', req: true }, { id: 'city', req: true }, { id: 'previous_address', req: false },
                { id: 'move_in_date', req: true }, { id: 'landlord_name', req: true }, { id: 'iban', req: true },
                { id: 'bic', req: true }, { id: 'account_holder', req: true }, { id: 'child_first_name', req: true },
                { id: 'child_last_name', req: true }, { id: 'child_birth_date', req: true },
                { id: 'child_birth_place', req: true }, { id: 'child_nationality', req: true },
                { id: 'signature_place', req: true }, { id: 'signature_date', req: true }
            ];

            fields.forEach(function(f) {
                setLabelText('lbl_' + f.id, t('labels.' + f.id, f.id), f.req);
                var input = document.getElementById(f.id);
                if (input && input.tagName !== 'SELECT') {
                    input.placeholder = t('placeholders.' + f.id, '');
                }
            });

            document.getElementById('opt_ms_empty').textContent = t('select.empty', '-- Select --');
            document.getElementById('opt_ms_single').textContent = t('select.ms.single', 'Single');
            document.getElementById('opt_ms_married').textContent = t('select.ms.married', 'Married');
            document.getElementById('opt_ms_divorced').textContent = t('select.ms.divorced', 'Divorced');
            document.getElementById('opt_ms_widowed').textContent = t('select.ms.widowed', 'Widowed');
            document.getElementById('opt_ms_separated').textContent = t('select.ms.separated', 'Separated');
            document.getElementById('opt_ms_civil_union').textContent = t('select.ms.civil_union', 'Civil Union');

            document.getElementById('opt_rel_empty').textContent = t('select.empty', '-- Select --');
            document.getElementById('opt_rel_none').textContent = t('select.rel.none', 'None');
            document.getElementById('opt_rel_protestant').textContent = t('select.rel.protestant', 'Protestant');
            document.getElementById('opt_rel_catholic').textContent = t('select.rel.catholic', 'Catholic');
            document.getElementById('opt_rel_orthodox').textContent = t('select.rel.orthodox', 'Orthodox');
            document.getElementById('opt_rel_muslim').textContent = t('select.rel.muslim', 'Muslim');
            document.getElementById('opt_rel_jewish').textContent = t('select.rel.jewish', 'Jewish');
            document.getElementById('opt_rel_other').textContent = t('select.rel.other', 'Other');
        }

        applyTranslations();

        // ========================================
        // SECTIONS
        // ========================================
        var sectionMap = {
            personal: document.getElementById('section_personal'),
            address: document.getElementById('section_address'),
            housing: document.getElementById('section_housing'),
            bank: document.getElementById('section_bank'),
            child: document.getElementById('section_child'),
            signature: document.getElementById('section_signature')
        };

        Object.keys(sectionMap).forEach(function(k) {
            if (sectionMap[k]) sectionMap[k].classList.remove('visible');
        });
        DOCS[currentDocType].sections.forEach(function(k) {
            if (sectionMap[k]) sectionMap[k].classList.add('visible');
        });

        if (!DOCS[currentDocType].showPreviousAddress) {
            var pg = document.getElementById('group_previous_address');
            if (pg) pg.style.display = 'none';
        }
        if (!DOCS[currentDocType].showMoveInDate) {
            var mg = document.getElementById('group_move_in_date');
            if (mg) mg.style.display = 'none';
            var mid = document.getElementById('move_in_date');
            if (mid) mid.setAttribute('data-required', 'false');
        }

        // ========================================
        // ACTIVE FIELDS
        // ========================================
        var isSubmitting = false;
        var saveTimeout = null;
        var activeFields = {};
        var errorHints = {};

        function collectActiveFields() {
            activeFields = {};
            errorHints = {};
            var allControls = form.querySelectorAll('input, select, textarea');
            allControls.forEach(function(ctrl) {
                var sectionEl = ctrl.closest('.form-section');
                if (!sectionEl || !sectionEl.classList.contains('visible')) return;
                var groupEl = ctrl.closest('.form-group');
                if (groupEl && groupEl.style.display === 'none') return;
                activeFields[ctrl.id] = ctrl;
                var hint = document.getElementById('err_' + ctrl.id);
                if (hint) errorHints[ctrl.id] = hint;
            });
            var requiredCount = 0;
            Object.keys(activeFields).forEach(function(id) {
                if (activeFields[id].getAttribute('data-required') === 'true') requiredCount++;
            });
            totalCountEl.textContent = requiredCount;
        }

        collectActiveFields();

        // ========================================
        // VALIDATION
        // ========================================
        function isValidDate(value) {
            if (!value) return false;
            var m = value.match(/^(\d{2})\.(\d{2})\.(\d{4})$/);
            if (!m) return false;
            var d = parseInt(m[1], 10), mo = parseInt(m[2], 10), y = parseInt(m[3], 10);
            return mo >= 1 && mo <= 12 && d >= 1 && d <= 31 && y >= 1900 && y <= 2100;
        }

        function isValidPLZ(value) { return /^\d{5}$/.test(value); }
        function normalizeIBAN(raw) { return (raw || '').toUpperCase().replace(/[^A-Z0-9]/g, ''); }
        function formatIBAN(raw) {
            var v = normalizeIBAN(raw), out = '';
            for (var i = 0; i < v.length; i++) { if (i > 0 && i % 4 === 0) out += ' '; out += v[i]; }
            return out.trim();
        }
        function isValidIBAN(value) {
            var v = normalizeIBAN(value);
            return v.length >= 15 && v.length <= 34 && /^[A-Z]{2}\d{2}[A-Z0-9]+$/.test(v);
        }
        function normalizeBIC(raw) { return (raw || '').toUpperCase().replace(/[^A-Z0-9]/g, ''); }
        function isValidBIC(value) { var v = normalizeBIC(value); return /^[A-Z0-9]{8}([A-Z0-9]{3})?$/.test(v); }

        function formatDateInput(input) {
            var digits = input.value.replace(/[^\d]/g, '');
            var f = '';
            if (digits.length > 0) f = digits.substring(0, 2);
            if (digits.length > 2) f += '.' + digits.substring(2, 4);
            if (digits.length > 4) f += '.' + digits.substring(4, 8);
            input.value = f;
        }

        function validateField(fieldId, showError) {
            var input = activeFields[fieldId];
            if (!input) return true;
            var hint = errorHints[fieldId];
            var value = (input.value || '').trim();
            var format = input.getAttribute('data-format');
            var minLen = parseInt(input.getAttribute('data-min'), 10) || 0;
            var isReq = input.getAttribute('data-required') === 'true';
            var valid = true;

            input.classList.remove('valid', 'invalid');
            if (hint) hint.classList.remove('visible');

            if (!isReq && !value) return true;
            if (isReq && !value) { if (showError) { input.classList.add('invalid'); if (hint) hint.classList.add('visible'); } return false; }

            if (format === 'date') valid = isValidDate(value);
            else if (format === 'plz') valid = isValidPLZ(value);
            else if (format === 'iban') valid = isValidIBAN(value);
            else if (format === 'bic') valid = isValidBIC(value);
            else if (minLen > 0) valid = value.length >= minLen;
            else if (input.tagName === 'SELECT' && isReq) valid = value.length > 0;

            if (valid) input.classList.add('valid');
            else if (showError || value) { input.classList.add('invalid'); if (hint) hint.classList.add('visible'); }
            return valid;
        }

        function canSubmit() {
            var ok = true;
            Object.keys(activeFields).forEach(function(id) {
                var inp = activeFields[id];
                if (inp.getAttribute('data-required') !== 'true') return;
                var v = (inp.value || '').trim();
                var fmt = inp.getAttribute('data-format');
                var minL = parseInt(inp.getAttribute('data-min'), 10) || 0;
                if (!v) ok = false;
                else if (fmt === 'date' && !isValidDate(v)) ok = false;
                else if (fmt === 'plz' && !isValidPLZ(v)) ok = false;
                else if (fmt === 'iban' && !isValidIBAN(v)) ok = false;
                else if (fmt === 'bic' && !isValidBIC(v)) ok = false;
                else if (minL > 0 && v.length < minL) ok = false;
            });
            return ok;
        }

        function updateFieldCounter() {
            var c = 0;
            Object.keys(activeFields).forEach(function(id) {
                if (activeFields[id].getAttribute('data-required') === 'true' && (activeFields[id].value || '').trim()) c++;
            });
            filledCountEl.textContent = c;
        }

        function updateUI() {
            var ok = canSubmit();
            submitBtn.disabled = !ok || isSubmitting;
            if (ok) {
                validationStatus.classList.remove('incomplete');
                validationStatus.classList.add('complete');
                statusIcon.textContent = '‚úÖ';
                statusText.textContent = t('ui.ready', 'Ready');
            } else {
                validationStatus.classList.remove('complete');
                validationStatus.classList.add('incomplete');
                statusIcon.textContent = '‚ö†Ô∏è';
                statusText.textContent = t('ui.incomplete', 'Fill required fields');
            }
            updateFieldCounter();
        }

        // ========================================
        // DRAFT
        // ========================================
        var DRAFT_KEY = 'draft_' + currentDocType + '_' + currentLang;

        function saveDraft() {
            try {
                var data = {}, hasData = false;
                Object.keys(activeFields).forEach(function(id) {
                    var v = (activeFields[id].value || '').trim();
                    if (v) { data[id] = v; hasData = true; }
                });
                if (hasData) {
                    data._ts = Date.now();
                    localStorage.setItem(DRAFT_KEY, JSON.stringify(data));
                    draftStatus.classList.add('visible');
                } else {
                    localStorage.removeItem(DRAFT_KEY);
                    draftStatus.classList.remove('visible');
                }
            } catch (e) {}
        }

        function debouncedSave() {
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveDraft, 500);
        }

        function loadDraft() {
            try {
                var s = localStorage.getItem(DRAFT_KEY);
                if (!s) return false;
                var data = JSON.parse(s), restored = false;
                Object.keys(activeFields).forEach(function(id) {
                    if (data[id]) { activeFields[id].value = data[id]; restored = true; }
                });
                return restored;
            } catch (e) { return false; }
        }

        function clearDraft() {
            try { localStorage.removeItem(DRAFT_KEY); } catch (e) {}
            Object.keys(activeFields).forEach(function(id) {
                activeFields[id].value = '';
                activeFields[id].classList.remove('valid', 'invalid');
                if (errorHints[id]) errorHints[id].classList.remove('visible');
            });
            draftBanner.classList.remove('visible', 'fade-in');
            draftStatus.classList.remove('visible');
            updateUI();
        }

        clearDraftBtn.addEventListener('click', function(e) { e.preventDefault(); clearDraft(); });

        // ========================================
        // EVENTS
        // ========================================
        Object.keys(activeFields).forEach(function(id) {
            var inp = activeFields[id];
            var fmt = inp.getAttribute('data-format');

            inp.addEventListener('input', function() {
                if (fmt === 'date') formatDateInput(inp);
                else if (fmt === 'plz') inp.value = inp.value.replace(/\D/g, '').slice(0, 5);
                else if (fmt === 'iban') inp.value = formatIBAN(inp.value).slice(0, 42);
                else if (fmt === 'bic') inp.value = normalizeBIC(inp.value).slice(0, 11);
                validateField(id, false);
                updateUI();
                debouncedSave();
            });

            inp.addEventListener('blur', function() {
                var v = (inp.value || '').trim();
                if (v || inp.getAttribute('data-required') === 'true') validateField(id, true);
            });

            if (inp.tagName === 'SELECT') {
                inp.addEventListener('change', function() {
                    validateField(id, false);
                    updateUI();
                    debouncedSave();
                });
            }
        });

        // ========================================
        // SUBMIT (SINGLE HANDLER)
        // ========================================
        submitBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (isSubmitting) return;

            var allValid = true;
            Object.keys(activeFields).forEach(function(id) {
                if (!validateField(id, true)) allValid = false;
            });

            if (!allValid) {
                submitBtn.classList.add('shake');
                setTimeout(function() { submitBtn.classList.remove('shake'); }, 400);
                return;
            }

            isSubmitting = true;
            submitBtn.textContent = t('ui.generating', 'Generating...');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;

            var userAnswers = {};
            Object.keys(activeFields).forEach(function(id) {
                var el = activeFields[id];
                var v = (el.value || '').trim();
                if (!v) return;
                if (el.name === 'iban') v = normalizeIBAN(v);
                if (el.name === 'bic') v = normalizeBIC(v);
                userAnswers[el.name] = v;
            });

            var payload = { doc_type: currentDocType, user_answers: userAnswers };
            console.log('[WebApp] Payload:', payload);

            try { localStorage.removeItem(DRAFT_KEY); } catch (e) {}

            // ========================================
            // SEND DATA TO TELEGRAM BOT
            // ========================================
            console.log('[WebApp] === SENDING DATA ===');
            console.log('[WebApp] tg object:', tg);
            console.log('[WebApp] tg.sendData:', tg ? tg.sendData : 'N/A');
            console.log('[WebApp] Payload:', JSON.stringify(payload));
            
            if (tg && typeof tg.sendData === 'function') {
                try {
                    var jsonPayload = JSON.stringify(payload);
                    console.log('[WebApp] Calling tg.sendData() with:', jsonPayload);
                    
                    // Show sending status
                    statusIcon.textContent = 'üì§';
                    statusText.textContent = '–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–∞–Ω—ñ...';
                    
                    tg.sendData(jsonPayload);
                    
                    // If we reach here, sendData was called
                    // WebApp will be closed automatically by Telegram
                    console.log('[WebApp] ‚úÖ sendData() called successfully');
                    console.log('[WebApp] WebApp should close now and bot should receive data');
                    
                    // Update UI to show success (may not be visible if WebApp closes)
                    statusIcon.textContent = '‚úÖ';
                    statusText.textContent = '–î–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!';
                    
                } catch (err) {
                    console.error('[WebApp] ‚ùå sendData ERROR:', err);
                    console.error('[WebApp] Error details:', err.message, err.stack);
                    
                    // Show error to user
                    statusIcon.textContent = '‚ùå';
                    statusText.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + (err.message || '–Ω–µ–≤—ñ–¥–æ–º–∞');
                    
                    isSubmitting = false;
                    submitBtn.textContent = t('ui.submit', 'Submit');
                    submitBtn.classList.remove('loading');
                    updateUI();
                    
                    alert('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö: ' + (err.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
                }
            } else {
                // Not in Telegram context - show detailed debug info
                console.warn('[WebApp] ‚ö†Ô∏è NOT IN TELEGRAM CONTEXT');
                console.warn('[WebApp] window.Telegram:', window.Telegram);
                console.warn('[WebApp] tg:', tg);
                
                statusIcon.textContent = '‚ö†Ô∏è';
                statusText.textContent = '–¢–µ—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º (–Ω–µ –≤ Telegram)';
                
                // Show debug alert
                var debugMsg = 'WebApp –ø—Ä–∞—Ü—é—î –≤ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ.\n\n';
                debugMsg += '–î–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:\n';
                debugMsg += '- –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: ' + payload.doc_type + '\n';
                debugMsg += '- –ü–æ–ª—ñ–≤ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ: ' + Object.keys(payload.user_answers).length + '\n\n';
                debugMsg += '–î–ª—è —Ä–µ–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç.';
                
                alert(debugMsg);
                
                setTimeout(function() {
                    isSubmitting = false;
                    submitBtn.textContent = t('ui.submit', 'Submit');
                    submitBtn.classList.remove('loading');
                    updateUI();
                }, 2000);
            }
        });

        // ========================================
        // BACK BUTTON
        // ========================================
        if (tg && tg.BackButton) {
            tg.BackButton.show();
            tg.BackButton.onClick(function() { if (tg.close) tg.close(); });
        }

        // ========================================
        // INIT
        // ========================================
        var draftRestored = loadDraft();
        if (draftRestored) {
            draftBanner.classList.add('visible', 'fade-in');
            Object.keys(activeFields).forEach(function(id) { validateField(id, false); });
        }
        updateUI();

        console.log('[WebApp] Ready: doc_type=' + currentDocType + ', lang=' + currentLang);
    })();
    </script>
</body>
</html>




















